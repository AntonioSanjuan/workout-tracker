(self.webpackChunkaccount=self.webpackChunkaccount||[]).push([[3894],{3894:(Ty,Yd,je)=>{je.d(Yd,{u7:()=>hu,Jj:()=>_e,IX:()=>p_,my:()=>tt,xU:()=>ze,Lz:()=>ye,WA:()=>_,F8:()=>Ji,$q:()=>Gr,W:()=>Ke,EK:()=>Z,PU:()=>Qd,l7:()=>oe,Ky:()=>A,Xb:()=>W,Cf:()=>M,K9:()=>am,Me:()=>Bm,yq:()=>Rt,Wi:()=>Ad,ET:()=>J_,Ab:()=>py,vr:()=>gy,Fc:()=>I_,hJ:()=>h_,B$:()=>d_,at:()=>Sd,oe:()=>X_,AK:()=>fy,TF:()=>v_,JU:()=>xd,ST:()=>__,fH:()=>y_,Ix:()=>E_,Wu:()=>q_,Lx:()=>L_,qY:()=>et,GL:()=>kn,QT:()=>K_,kl:()=>j_,Xk:()=>Q_,PL:()=>$_,UQ:()=>W_,zN:()=>H_,nP:()=>_y,b9:()=>k_,vh:()=>M_,Pb:()=>A_,L$:()=>w_,cf:()=>ty,sc:()=>ey,Xo:()=>N_,IO:()=>b_,iE:()=>tu,Eo:()=>f_,i3:()=>dy,Bt:()=>my,pl:()=>Z_,Ub:()=>om,qK:()=>z_,TQ:()=>O_,e0:()=>F_,r7:()=>Y_,Mx:()=>T_,ar:()=>D_});var w,p=je(9671),zr=je(534),Xd=je(4537),Ft=je(7879),q=je(9058),Jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},kt={},ls=ls||{},b=Jd||self;function Kr(n){var t=typeof n;return"array"==(t="object"!=t?t:n?Array.isArray(n)?"array":t:"null")||"object"==t&&"number"==typeof n.length}function Mn(n){var t=typeof n;return"object"==t&&null!=n||"function"==t}var hs="closure_uid_"+(1e9*Math.random()>>>0),ef=0;function nf(n,t,e){return n.call.apply(n.bind,arguments)}function rf(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(t,i)}}return function(){return n.apply(t,arguments)}}function yt(n,t,e){return(yt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?nf:rf).apply(null,arguments)}function jr(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ut(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function Jt(){this.s=this.s,this.o=this.o}Jt.prototype.s=!1,Jt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function tf(n){Object.prototype.hasOwnProperty.call(n,hs)&&n[hs]||(n[hs]=++ef)}(this)},Jt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const mu=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if("string"==typeof n)return"string"!=typeof t||1!=t.length?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function ds(n){const t=n.length;if(0<t){const e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function gu(n,t){for(let e=1;e<arguments.length;e++){const r=arguments[e];if(Kr(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function It(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}It.prototype.h=function(){this.defaultPrevented=!0};var of=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const e=()=>{};b.addEventListener("test",e,t),b.removeEventListener("test",e,t)}catch{}return n}();function Fn(n){return/^[\s\xa0]*$/.test(n)}function Qr(){var n=b.navigator;return n&&(n=n.userAgent)?n:""}function Ot(n){return-1!=Qr().indexOf(n)}function fs(n){return fs[" "](n),n}fs[" "]=function(){};var gs,n,uf=Ot("Opera"),Qe=Ot("Trident")||Ot("MSIE"),pu=Ot("Edge"),ms=pu||Qe,_u=Ot("Gecko")&&!(-1!=Qr().toLowerCase().indexOf("webkit")&&!Ot("Edge"))&&!(Ot("Trident")||Ot("MSIE"))&&!Ot("Edge"),cf=-1!=Qr().toLowerCase().indexOf("webkit")&&!Ot("Edge");function yu(){var n=b.document;return n?n.documentMode:void 0}t:{var ps="",_s=(n=Qr(),_u?/rv:([^\);]+)(\)|;)/.exec(n):pu?/Edge\/([\d\.]+)/.exec(n):Qe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):cf?/WebKit\/(\S+)/.exec(n):uf?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(_s&&(ps=_s?_s[1]:""),Qe){var ys=yu();if(null!=ys&&ys>parseFloat(ps)){gs=String(ys);break t}}gs=ps}var lf=b.document&&Qe&&(yu()||parseInt(gs,10))||void 0;function On(n,t){if(It.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(_u){t:{try{fs(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else"mouseover"==e?t=n.fromElement:"mouseout"==e&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:hf[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&On.$.h.call(this)}}ut(On,It);var hf={2:"touch",3:"pen",4:"mouse"};On.prototype.h=function(){On.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ln="closure_listenable_"+(1e6*Math.random()|0),df=0;function ff(n,t,e,r,i){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=i,this.key=++df,this.fa=this.ia=!1}function $r(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Ts(n,t,e){for(const r in n)t.call(e,n[r],r,n)}function Tu(n){const t={};for(const e in n)t[e]=n[e];return t}const Eu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function vu(n,t){let e,r;for(let i=1;i<arguments.length;i++){for(e in r=arguments[i],r)n[e]=r[e];for(let s=0;s<Eu.length;s++)e=Eu[s],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function Wr(n){this.src=n,this.g={},this.h=0}function Es(n,t){var e=t.type;if(e in n.g){var s,r=n.g[e],i=mu(r,t);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&($r(t),0==n.g[e].length&&(delete n.g[e],n.h--))}}function vs(n,t,e,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==r)return i}return-1}Wr.prototype.add=function(n,t,e,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=vs(n,t,r,i);return-1<o?(t=n[o],e||(t.ia=!1)):((t=new ff(t,this.src,s,!!r,i)).ia=e,n.push(t)),t};var As="closure_lm_"+(1e6*Math.random()|0),ws={};function Au(n,t,e,r,i){if(r&&r.once)return Ru(n,t,e,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Au(n,t[s],e,r,i);return null}return e=Ss(e),n&&n[Ln]?n.O(t,e,Mn(r)?!!r.capture:!!r,i):wu(n,t,e,!1,r,i)}function wu(n,t,e,r,i,s){if(!t)throw Error("Invalid event type");var o=Mn(i)?!!i.capture:!!i,a=Ps(n);if(a||(n[As]=a=new Wr(n)),(e=a.add(t,e,r,o,s)).proxy)return e;if(r=function gf(){const t=pf;return function n(e){return t.call(n.src,n.listener,e)}}(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)of||(i=o),void 0===i&&(i=!1),n.addEventListener(t.toString(),r,i);else if(n.attachEvent)n.attachEvent(Vu(t.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return e}function Ru(n,t,e,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ru(n,t[s],e,r,i);return null}return e=Ss(e),n&&n[Ln]?n.P(t,e,Mn(r)?!!r.capture:!!r,i):wu(n,t,e,!0,r,i)}function Pu(n,t,e,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Pu(n,t[s],e,r,i);else r=Mn(r)?!!r.capture:!!r,e=Ss(e),n&&n[Ln]?(n=n.i,(t=String(t).toString())in n.g&&-1<(e=vs(s=n.g[t],e,r,i))&&($r(s[e]),Array.prototype.splice.call(s,e,1),0==s.length&&(delete n.g[t],n.h--))):n&&(n=Ps(n))&&(t=n.g[t.toString()],n=-1,t&&(n=vs(t,e,r,i)),(e=-1<n?t[n]:null)&&Rs(e))}function Rs(n){if("number"!=typeof n&&n&&!n.fa){var t=n.src;if(t&&t[Ln])Es(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(Vu(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=Ps(t))?(Es(e,n),0==e.h&&(e.src=null,t[As]=null)):$r(n)}}}function Vu(n){return n in ws?ws[n]:ws[n]="on"+n}function pf(n,t){if(n.fa)n=!0;else{t=new On(t,this);var e=n.listener,r=n.la||n.src;n.ia&&Rs(n),n=e.call(r,t)}return n}function Ps(n){return(n=n[As])instanceof Wr?n:null}var Vs="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ss(n){return"function"==typeof n?n:(n[Vs]||(n[Vs]=function(t){return n.handleEvent(t)}),n[Vs])}function ct(){Jt.call(this),this.i=new Wr(this),this.S=this,this.J=null}function ft(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,"string"==typeof t)t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var i=t;vu(t=new It(r,n),i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];i=Hr(o,r,!0,t)&&i}if(i=Hr(o=t.g=n,r,!0,t)&&i,i=Hr(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)i=Hr(o=t.g=e[s],r,!1,t)&&i}function Hr(n,t,e,r){if(!(t=n.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&Es(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ut(ct,Jt),ct.prototype[Ln]=!0,ct.prototype.removeEventListener=function(n,t,e,r){Pu(this,n,t,e,r)},ct.prototype.N=function(){if(ct.$.N.call(this),this.i){var t,n=this.i;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)$r(e[r]);delete n.g[t],n.h--}}this.J=null},ct.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)},ct.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};var xs=b.JSON.stringify;function yf(){var n=Cs;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var Su=new class _f{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new Tf,n=>n.reset());class Tf{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ef(n){var t=1;n=n.split(":");const e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function vf(n){b.setTimeout(()=>{throw n},0)}let qn,Bn=!1,Cs=new class If{constructor(){this.h=this.g=null}add(t,e){const r=Su.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},xu=()=>{const n=b.Promise.resolve(void 0);qn=()=>{n.then(Af)}};var Af=()=>{for(var n;n=yf();){try{n.h.call(n.g)}catch(e){vf(e)}var t=Su;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Bn=!1};function Zr(n,t){ct.call(this),this.h=n||1,this.g=t||b,this.j=yt(this.qb,this),this.l=Date.now()}function bs(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Ds(n,t,e){if("function"==typeof n)e&&(n=yt(n,e));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=yt(n.handleEvent,n)}return 2147483647<Number(t)?-1:b.setTimeout(n,t||0)}function Cu(n){n.g=Ds(()=>{n.g=null,n.i&&(n.i=!1,Cu(n))},n.j);const t=n.h;n.h=null,n.m.apply(null,t)}ut(Zr,ct),(w=Zr.prototype).ga=!1,w.T=null,w.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ft(this,"tick"),this.ga&&(bs(this),this.start()))}},w.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},w.N=function(){Zr.$.N.call(this),bs(this),delete this.g};class wf extends Jt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Cu(this)}N(){super.N(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Un(n){Jt.call(this),this.h=n,this.g={}}ut(Un,Jt);var bu=[];function Du(n,t,e,r){Array.isArray(e)||(e&&(bu[0]=e.toString()),e=bu);for(var i=0;i<e.length;i++){var s=Au(t,e[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Nu(n){Ts(n.g,function(t,e){this.g.hasOwnProperty(e)&&Rs(t)},n),n.g={}}function Yr(){this.g=!0}function $e(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+function Sf(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e)for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return xs(e)}catch{return t}}(n,e)+(r?" "+r:"")})}Un.prototype.N=function(){Un.$.N.call(this),Nu(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Yr.prototype.Ea=function(){this.g=!1},Yr.prototype.info=function(){};var Ee={},ku=null;function Xr(){return ku=ku||new ct}function Mu(n){It.call(this,Ee.Ta,n)}function Gn(n){const t=Xr();ft(t,new Mu(t))}function Fu(n,t){It.call(this,Ee.STAT_EVENT,n),this.stat=t}function At(n){const t=Xr();ft(t,new Fu(t,n))}function Ou(n,t){It.call(this,Ee.Ua,n),this.size=t}function zn(n,t){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){n()},t)}Ee.Ta="serverreachability",ut(Mu,It),Ee.STAT_EVENT="statevent",ut(Fu,It),Ee.Ua="timingevent",ut(Ou,It);var Jr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Lu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ns(){}function Bu(){}Ns.prototype.h=null;var Fs,Kn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ks(){It.call(this,"d")}function Ms(){It.call(this,"c")}function ti(){}function jn(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new Un(this),this.P=xf,this.V=new Zr(n=ms?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Uu}function Uu(){this.i=null,this.g="",this.h=!1}ut(ks,It),ut(Ms,It),ut(ti,Ns),ti.prototype.g=function(){return new XMLHttpRequest},ti.prototype.i=function(){return{}},Fs=new ti;var xf=45e3,Gu={},Os={};function Ls(n,t,e){n.L=1,n.A=ii(jt(t)),n.u=e,n.S=!0,zu(n,null)}function zu(n,t){n.G=Date.now(),Qn(n),n.B=jt(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Ju(e.i,"t",r),n.o=0,e=n.l.J,n.h=new Uu,n.g=Ac(n.l,e?t:null,!n.u),0<n.O&&(n.M=new wf(yt(n.Pa,n,n.g),n.O)),Du(n.U,n.g,"readystatechange",n.nb),t=n.I?Tu(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Gn(),function Rf(n,t,e,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+e+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function Ku(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function ju(n,t,e){let i,r=!0;for(;!n.J&&n.o<e.length;){if(i=Cf(n,e),i==Os){4==t&&(n.s=4,At(14),r=!1),$e(n.j,n.m,null,"[Incomplete Response]");break}if(i==Gu){n.s=4,At(15),$e(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}$e(n.j,n.m,i,null),qs(n,i)}Ku(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=t||0!=e.length||n.h.h||(n.s=1,At(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,(t=n.l).g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Qs(t),t.M=!0,At(11))):($e(n.j,n.m,e,"[Invalid Chunked Response]"),ve(n),$n(n))}function Cf(n,t){var e=n.o,r=t.indexOf("\n",e);return-1==r?Os:(e=Number(t.substring(e,r)),isNaN(e)?Gu:(r+=1)+e>t.length?Os:(t=t.slice(r,r+e),n.o=r+e,t))}function Qn(n){n.Y=Date.now()+n.P,Qu(n,n.P)}function Qu(n,t){if(null!=n.C)throw Error("WatchDog timer not null");n.C=zn(yt(n.lb,n),t)}function ei(n){n.C&&(b.clearTimeout(n.C),n.C=null)}function $n(n){0==n.l.H||n.J||Ic(n.l,n)}function ve(n){ei(n);var t=n.M;t&&"function"==typeof t.sa&&t.sa(),n.M=null,bs(n.V),Nu(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function qs(n,t){try{var e=n.l;if(0!=e.H&&(e.g==n||Bs(e.i,n)))if(!n.K&&Bs(e.i,n)&&3==e.H){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!e.u){if(e.g){if(!(e.g.G+3e3<n.G))break t;li(e),ui(e)}js(e),At(18)}}else e.Fa=i[1],0<e.Fa-e.V&&37500>i[2]&&e.G&&0==e.A&&!e.v&&(e.v=zn(yt(e.ib,e),6e3));if(1>=nc(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else we(e,11)}else if((n.K||e.g==n)&&li(e),!Fn(t))for(i=e.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(e.V=c[0],c=c[1],2==e.H)if("c"==c[0]){e.K=c[1],e.pa=c[2];const l=c[3];null!=l&&(e.ra=l,e.l.info("VER="+e.ra));const h=c[4];null!=h&&(e.Ga=h,e.l.info("SVER="+e.Ga));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(e.L=r=1.5*d,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;const m=n.g;if(m){const I=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(I){var s=r.i;s.g||-1==I.indexOf("spdy")&&-1==I.indexOf("quic")&&-1==I.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Us(s,s.h),s.h=null))}if(r.F){const v=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(r.Da=v,$(r.I,r.F,v))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms"));var o=n;if((r=e).wa=vc(r,r.J?r.pa:null,r.Y),o.K){rc(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ei(a),Qn(a)),r.g=o}else _c(r);0<e.j.length&&ci(e)}else"stop"!=c[0]&&"close"!=c[0]||we(e,7);else 3==e.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?we(e,7):Ks(e):"noop"!=c[0]&&e.h&&e.h.Aa(c),e.A=0)}Gn()}catch{}}function $u(n,t){if(n.forEach&&"function"==typeof n.forEach)n.forEach(t,void 0);else if(Kr(n)||"string"==typeof n)Array.prototype.forEach.call(n,t,void 0);else for(var e=function Df(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Kr(n)||"string"==typeof n){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(const r in n)t[e++]=r;return t}}}(n),r=function bf(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Kr(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}for(r in t=[],e=0,n)t[e++]=n[r];return t}(n),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],e&&e[s],n)}(w=jn.prototype).setTimeout=function(n){this.P=n},w.nb=function(n){n=n.target;const t=this.M;t&&3==Lt(n)?t.l():this.Pa(n)},w.Pa=function(n){try{if(n==this.g)t:{const l=Lt(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||ms||this.g&&(this.h.h||this.g.ja()||hc(this.g)))){this.J||4!=l||7==t||Gn(),ei(this);var e=this.g.da();this.ca=e;e:if(Ku(this)){var r=hc(this.g);n="";var i=r.length,s=4==Lt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){ve(this),$n(this);var o="";break e}this.h.i=new b.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==e,function Pf(n,t,e,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+e+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Fn(a)){var c=a;break e}}c=null}if(!(e=c)){this.i=!1,this.s=3,At(12),ve(this),$n(this);break t}$e(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qs(this,e)}this.S?(ju(this,l,o),ms&&this.i&&3==l&&(Du(this.U,this.V,"tick",this.mb),this.V.start())):($e(this.j,this.m,o,null),qs(this,o)),4==l&&ve(this),this.i&&!this.J&&(4==l?Ic(this.l,this):(this.i=!1,Qn(this)))}else(function Zf(n){const t={};n=(n.g&&2<=Lt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Fn(n[r]))continue;var e=Ef(n[r]);const i=e[0];if("string"!=typeof(e=e[1]))continue;e=e.trim();const s=t[i]||[];t[i]=s,s.push(e)}!function mf(n,t){for(const e in n)t.call(void 0,n[e],e,n)}(t,function(r){return r.join(", ")})})(this.g),400==e&&0<o.indexOf("Unknown SID")?(this.s=3,At(12)):(this.s=0,At(13)),ve(this),$n(this)}}}catch{}},w.mb=function(){if(this.g){var n=Lt(this.g),t=this.g.ja();this.o<t.length&&(ei(this),ju(this,n,t),this.i&&4!=n&&Qn(this))}},w.cancel=function(){this.J=!0,ve(this)},w.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function Vf(n,t){n.info(function(){return"TIMEOUT: "+t})}(this.j,this.B),2!=this.L&&(Gn(),At(17)),ve(this),this.s=2,$n(this)):Qu(this,this.Y-n)};var Wu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ae(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ae){this.h=n.h,ni(this,n.j),this.s=n.s,this.g=n.g,ri(this,n.m),this.l=n.l;var t=n.i,e=new Zn;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Hu(this,e),this.o=n.o}else n&&(t=String(n).match(Wu))?(this.h=!1,ni(this,t[1]||"",!0),this.s=Wn(t[2]||""),this.g=Wn(t[3]||"",!0),ri(this,t[4]),this.l=Wn(t[5]||"",!0),Hu(this,t[6]||"",!0),this.o=Wn(t[7]||"")):(this.h=!1,this.i=new Zn(null,this.h))}function jt(n){return new Ae(n)}function ni(n,t,e){n.j=e?Wn(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function ri(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Hu(n,t,e){t instanceof Zn?(n.i=t,function qf(n,t){t&&!n.j&&(te(n),n.i=null,n.g.forEach(function(e,r){var i=r.toLowerCase();r!=i&&(Yu(this,r),Ju(this,i,e))},n)),n.j=t}(n.i,n.h)):(e||(t=Hn(t,Of)),n.i=new Zn(t,n.h))}function $(n,t,e){n.i.set(t,e)}function ii(n){return $(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Wn(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Hn(n,t,e){return"string"==typeof n?(n=encodeURI(n).replace(t,kf),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function kf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Ae.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Hn(t,Zu,!0),":");var e=this.g;return(e||"file"==t)&&(n.push("//"),(t=this.s)&&n.push(Hn(t,Zu,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&n.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&n.push("/"),n.push(Hn(e,"/"==e.charAt(0)?Ff:Mf,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Hn(e,Lf)),n.join("")};var Zu=/[#\/\?@]/g,Mf=/[#\?:]/g,Ff=/[#\?]/g,Of=/[#\?@]/g,Lf=/#/g;function Zn(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function te(n){n.g||(n.g=new Map,n.h=0,n.i&&function Nf(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),i=null;if(0<=r){var s=n[e].substring(0,r);i=n[e].substring(r+1)}else s=n[e];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Yu(n,t){te(n),t=We(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function Xu(n,t){return te(n),t=We(n,t),n.g.has(t)}function Ju(n,t,e){Yu(n,t),0<e.length&&(n.i=null,n.g.set(We(n,t),ds(e)),n.h+=e.length)}function We(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}(w=Zn.prototype).add=function(n,t){te(this),this.i=null,n=We(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this},w.forEach=function(n,t){te(this),this.g.forEach(function(e,r){e.forEach(function(i){n.call(t,i,r,this)},this)},this)},w.ta=function(){te(this);const n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){const i=n[r];for(let s=0;s<i.length;s++)e.push(t[r])}return e},w.Z=function(n){te(this);let t=[];if("string"==typeof n)Xu(this,n)&&(t=t.concat(this.g.get(We(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t},w.set=function(n,t){return te(this),this.i=null,Xu(this,n=We(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this},w.get=function(n,t){return n&&0<(n=this.Z(n)).length?String(n[0]):t},w.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Bf=class{constructor(n,t){this.g=n,this.map=t}};function tc(n){this.l=n||Uf,n=b.PerformanceNavigationTiming?0<(n=b.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(b.g&&b.g.Ka&&b.g.Ka()&&b.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Uf=10;function ec(n){return!!n.h||!!n.g&&n.g.size>=n.j}function nc(n){return n.h?1:n.g?n.g.size:0}function Bs(n,t){return n.h?n.h==t:!!n.g&&n.g.has(t)}function Us(n,t){n.g?n.g.add(t):n.h=t}function rc(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}function ic(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let t=n.i;for(const e of n.g.values())t=t.concat(e.F);return t}return ds(n.i)}tc.prototype.cancel=function(){if(this.i=ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Gf=class{stringify(n){return b.JSON.stringify(n,void 0)}parse(n){return b.JSON.parse(n,void 0)}};function zf(){this.g=new Gf}function Kf(n,t,e){const r=e||"";try{$u(n,function(i,s){let o=i;Mn(i)&&(o=xs(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function si(n,t,e,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function Yn(n){this.l=n.ec||null,this.j=n.ob||!1}function oi(n,t){ct.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=Gs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ut(Yn,Ns),Yn.prototype.g=function(){return new oi(this.l,this.j)},Yn.prototype.i=function(n){return function(){return n}}({}),ut(oi,ct);var Gs=0;function sc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Xn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Jn(n)}function Jn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(w=oi.prototype).open=function(n,t){if(this.readyState!=Gs)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Jn(this)},w.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||b).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},w.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Xn(this)),this.readyState=Gs},w.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Jn(this)),this.g&&(this.readyState=3,Jn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof b.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;sc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},w.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Xn(this):Jn(this),3==this.readyState&&sc(this)}},w.Za=function(n){this.g&&(this.response=this.responseText=n,Xn(this))},w.Ya=function(n){this.g&&(this.response=n,Xn(this))},w.ka=function(){this.g&&Xn(this)},w.setRequestHeader=function(n,t){this.v.append(n,t)},w.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},w.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],t=this.h.entries();for(var e=t.next();!e.done;)n.push((e=e.value)[0]+": "+e[1]),e=t.next();return n.join("\r\n")},Object.defineProperty(oi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Qf=b.JSON.parse;function X(n){ct.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=oc,this.L=this.M=!1}ut(X,ct);var oc="",$f=/^https?$/i,Wf=["POST","PUT"];function ac(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,uc(n),ai(n)}function uc(n){n.F||(n.F=!0,ft(n,"complete"),ft(n,"error"))}function cc(n){if(n.h&&typeof ls<"u"&&(!n.C[1]||4!=Lt(n)||2!=n.da()))if(n.v&&4==Lt(n))Ds(n.La,0,n);else if(ft(n,"readystatechange"),4==Lt(n)){n.h=!1;try{const o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=0===o){var i=String(n.I).match(Wu)[1]||null;!i&&b.self&&b.self.location&&(i=b.self.location.protocol.slice(0,-1)),r=!$f.test(i?i.toLowerCase():"")}e=r}if(e)ft(n,"complete"),ft(n,"success");else{n.m=6;try{var s=2<Lt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",uc(n)}}finally{ai(n)}}}function ai(n,t){if(n.g){lc(n);const e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||ft(n,"ready");try{e.onreadystatechange=r}catch{}}}function lc(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(b.clearTimeout(n.A),n.A=null)}function Lt(n){return n.g?n.g.readyState:0}function hc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case oc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function dc(n){let t="";return Ts(n,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function zs(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=dc(e),"string"==typeof n?null!=e&&encodeURIComponent(String(e)):$(n,t,e))}function tr(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function fc(n){this.Ga=0,this.j=[],this.l=new Yr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=tr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=tr("baseRetryDelayMs",5e3,n),this.hb=tr("retryDelaySeedMs",1e4,n),this.eb=tr("forwardChannelMaxRetries",2,n),this.xa=tr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new tc(n&&n.concurrentRequestLimit),this.Ja=new zf,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Ks(n){if(mc(n),3==n.H){var t=n.W++,e=jt(n.I);if($(e,"SID",n.K),$(e,"RID",t),$(e,"TYPE","terminate"),er(n,e),(t=new jn(n,n.l,t)).L=2,t.A=ii(jt(e)),e=!1,b.navigator&&b.navigator.sendBeacon)try{e=b.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&b.Image&&((new Image).src=t.A,e=!0),e||(t.g=Ac(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Qn(t)}Ec(n)}function ui(n){n.g&&(Qs(n),n.g.cancel(),n.g=null)}function mc(n){ui(n),n.u&&(b.clearTimeout(n.u),n.u=null),li(n),n.i.cancel(),n.m&&("number"==typeof n.m&&b.clearTimeout(n.m),n.m=null)}function ci(n){if(!ec(n.i)&&!n.m){n.m=!0;var t=n.Na;qn||xu(),Bn||(qn(),Bn=!0),Cs.add(t,n),n.C=0}}function gc(n,t){var e;e=t?t.m:n.W++;const r=jt(n.I);$(r,"SID",n.K),$(r,"RID",e),$(r,"AID",n.V),er(n,r),n.o&&n.s&&zs(r,n.o,n.s),e=new jn(n,n.l,e,n.C+1),null===n.o&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=pc(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Us(n.i,e),Ls(e,r,t)}function er(n,t){n.na&&Ts(n.na,function(e,r){$(t,r,e)}),n.h&&$u({},function(e,r){$(t,r,e)})}function pc(n,t,e){e=Math.min(n.j.length,e);var r=n.h?yt(n.h.Va,n.h,n):null;t:{var i=n.j;let s=-1;for(;;){const o=["count="+e];-1==s?0<e?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<e;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Kf(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function _c(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;qn||xu(),Bn||(qn(),Bn=!0),Cs.add(t,n),n.A=0}}function js(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=zn(yt(n.Ma,n),Tc(n,n.A)),n.A++,0))}function Qs(n){null!=n.B&&(b.clearTimeout(n.B),n.B=null)}function yc(n){n.g=new jn(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var t=jt(n.wa);$(t,"RID","rpc"),$(t,"SID",n.K),$(t,"AID",n.V),$(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&$(t,"TO",n.qa),$(t,"TYPE","xmlhttp"),er(n,t),n.o&&n.s&&zs(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=ii(jt(t)),e.u=null,e.S=!0,zu(e,n)}function li(n){null!=n.v&&(b.clearTimeout(n.v),n.v=null)}function Ic(n,t){var e=null;if(n.g==t){li(n),Qs(n),n.g=null;var r=2}else{if(!Bs(n.i,t))return;e=t.F,rc(n.i,t),r=1}if(0!=n.H)if(t.i)if(1==r){e=t.u?t.u.length:0,t=Date.now()-t.G;var i=n.C;ft(r=Xr(),new Ou(r,e)),ci(n)}else _c(n);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function Yf(n,t){return!(nc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=t.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=zn(yt(n.Na,n,t),Tc(n,n.C)),n.C++,0)))}(n,t)||2==r&&js(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),i){case 1:we(n,5);break;case 4:we(n,10);break;case 3:we(n,6);break;default:we(n,2)}}function Tc(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function we(n,t){if(n.l.info("Error code "+t),2==t){var e=null;n.h&&(e=null);var r=yt(n.pb,n);e||(e=new Ae("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||ni(e,"https"),ii(e)),function jf(n,t){const e=new Yr;if(b.Image){const r=new Image;r.onload=jr(si,e,r,"TestLoadImage: loaded",!0,t),r.onerror=jr(si,e,r,"TestLoadImage: error",!1,t),r.onabort=jr(si,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=jr(si,e,r,"TestLoadImage: timeout",!1,t),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}(e.toString(),r)}else At(2);n.H=0,n.h&&n.h.za(t),Ec(n),mc(n)}function Ec(n){if(n.H=0,n.ma=[],n.h){const t=ic(n.i);(0!=t.length||0!=n.j.length)&&(gu(n.ma,t),gu(n.ma,n.j),n.i.i.length=0,ds(n.j),n.j.length=0),n.h.ya()}}function vc(n,t,e){var r=e instanceof Ae?jt(e):new Ae(e);if(""!=r.g)t&&(r.g=t+"."+r.g),ri(r,r.m);else{var i=b.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Ae(null);r&&ni(s,r),t&&(s.g=t),i&&ri(s,i),e&&(s.l=e),r=s}return t=n.Da,(e=n.F)&&t&&$(r,e,t),$(r,"VER",n.ra),er(n,r),r}function Ac(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new X(n.Ha&&!n.va?new Yn({ob:e}):n.va)).Oa(n.J),t}function wc(){}function hi(){if(Qe&&!(10<=Number(lf)))throw Error("Environmental error: no available transport.")}function St(n,t){ct.call(this),this.g=new fc(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Fn(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Fn(t)&&(this.g.F=t,null!==(n=this.h)&&t in n&&t in(n=this.h)&&delete n[t]),this.j=new He(this)}function Rc(n){ks.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(const e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=null!==t&&n in t?t[n]:void 0),this.data=t}else this.data=n}function Pc(){Ms.call(this),this.status=1}function He(n){this.g=n}function Mt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function $s(n,t,e){e||(e=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(i=0;16>i;++i)r[i]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;var s=n.g[3],o=(t=n.g[0])+(s^(e=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=(e=(i=(s=(t=e+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(e^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(e^s&(t^e))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=e+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^e&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(e^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(e^s&(t^e))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=e+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^e&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(e^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(e^s&(t^e))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=e+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^e&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(e^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(e^s&(t^e))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=e+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(e^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(e^i&(t^e))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^e&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=e+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(e^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(e^i&(t^e))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^e&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=e+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(e^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(e^i&(t^e))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^e&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=e+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(e^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(e^i&(t^e))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^e&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=e+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(e^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^e^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^e)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=e+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(e^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^e^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^e)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=e+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(e^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^e^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^e)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=e+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(e^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^e^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^e)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=e+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(e|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(e^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~e))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=e+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(e|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(e^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~e))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=e+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(e|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(e^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~e))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=e+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=e+((o=t+(i^(e|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(e^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~e))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function B(n,t){this.h=t;for(var e=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==t||(e[i]=s,r=!1)}this.g=e}(w=X.prototype).Oa=function(n){this.M=n},w.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Fs.g(),this.C=function qu(n){return n.h||(n.h=n.i())}(this.u?this.u:Fs),this.g.onreadystatechange=yt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){return void ac(this,s)}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)e.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())e.set(s,r.get(s))}r=Array.from(e.keys()).find(s=>"content-type"==s.toLowerCase()),i=b.FormData&&n instanceof b.FormData,!(0<=mu(Wf,t))||r||i||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{lc(this),0<this.B&&((this.L=function Hf(n){return Qe&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=yt(this.ua,this)):this.A=Ds(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){ac(this,s)}},w.ua=function(){typeof ls<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ft(this,"timeout"),this.abort(8))},w.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ft(this,"complete"),ft(this,"abort"),ai(this))},w.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ai(this,!0)),X.$.N.call(this)},w.La=function(){this.s||(this.G||this.v||this.l?cc(this):this.kb())},w.kb=function(){cc(this)},w.isActive=function(){return!!this.g},w.da=function(){try{return 2<Lt(this)?this.g.status:-1}catch{return-1}},w.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},w.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&0==t.indexOf(n)&&(t=t.substring(n.length)),Qf(t)}},w.Ia=function(){return this.m},w.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(w=fc.prototype).ra=8,w.H=1,w.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new jn(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Tu(s),vu(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){var r=this.j[e];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=e;break t}if(4096===t||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=pc(this,i,t),$(e=jt(this.I),"RID",n),$(e,"CVER",22),this.F&&$(e,"X-HTTP-Session-Id",this.F),er(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(dc(s)))+"&"+t:this.o&&zs(e,this.o,s)),Us(this.i,i),this.bb&&$(e,"TYPE","init"),this.P?($(e,"$req",t),$(e,"SID","null"),i.aa=!0,Ls(i,e,null)):Ls(i,e,t),this.H=2}}else 3==this.H&&(n?gc(this,n):0==this.j.length||ec(this.i)||gc(this))},w.Ma=function(){if(this.u=null,yc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=zn(yt(this.jb,this),n)}},w.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,At(10),ui(this),yc(this))},w.ib=function(){null!=this.v&&(this.v=null,ui(this),js(this),At(19))},w.pb=function(n){n?(this.l.info("Successfully pinged google.com"),At(2)):(this.l.info("Failed to ping google.com"),At(1))},w.isActive=function(){return!!this.h&&this.h.isActive(this)},(w=wc.prototype).Ba=function(){},w.Aa=function(){},w.za=function(){},w.ya=function(){},w.isActive=function(){return!0},w.Va=function(){},hi.prototype.g=function(n,t){return new St(n,t)},ut(St,ct),St.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;At(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=vc(n,null,n.Y),ci(n)},St.prototype.close=function(){Ks(this.g)},St.prototype.u=function(n){var t=this.g;if("string"==typeof n){var e={};e.__data__=n,n=e}else this.v&&((e={}).__data__=xs(n),n=e);t.j.push(new Bf(t.fb++,n)),3==t.H&&ci(t)},St.prototype.N=function(){this.g.h=null,delete this.j,Ks(this.g),delete this.g,St.$.N.call(this)},ut(Rc,ks),ut(Pc,Ms),ut(He,wc),He.prototype.Ba=function(){ft(this.g,"a")},He.prototype.Aa=function(n){ft(this.g,new Rc(n))},He.prototype.za=function(n){ft(this.g,new Pc)},He.prototype.ya=function(){ft(this.g,"b")},ut(Mt,function Xf(){this.blockSize=-1}),Mt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Mt.prototype.j=function(n,t){void 0===t&&(t=n.length);for(var e=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=e;)$s(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<t;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){$s(this,r),i=0;break}}else for(;s<t;)if(r[i++]=n[s++],i==this.blockSize){$s(this,r),i=0;break}}this.h=i,this.i+=t},Mt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=255&e,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};var Jf={};function Ws(n){return-128<=n&&128>n?function af(n,t){var e=Jf;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}(n,function(t){return new B([0|t],0>t?-1:0)}):new B([0|n],0>n?-1:0)}function qt(n){if(isNaN(n)||!isFinite(n))return Ze;if(0>n)return mt(qt(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=Hs;return new B(t,0)}var Hs=4294967296,Ze=Ws(0),Zs=Ws(1),Sc=Ws(16777216);function Qt(n){if(0!=n.h)return!1;for(var t=0;t<n.g.length;t++)if(0!=n.g[t])return!1;return!0}function bt(n){return-1==n.h}function mt(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new B(e,~n.h).add(Zs)}function di(n,t){return n.add(mt(t))}function fi(n,t){for(;(65535&n[t])!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function nr(n,t){this.g=n,this.h=t}function mi(n,t){if(Qt(t))throw Error("division by zero");if(Qt(n))return new nr(Ze,Ze);if(bt(n))return t=mi(mt(n),t),new nr(mt(t.g),mt(t.h));if(bt(t))return t=mi(n,mt(t)),new nr(mt(t.g),t.h);if(30<n.g.length){if(bt(n)||bt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=Zs,r=t;0>=r.X(n);)e=xc(e),r=xc(r);var i=Ye(e,1),s=Ye(r,1);for(r=Ye(r,2),e=Ye(e,2);!Qt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(e),s=o),r=Ye(r,1),e=Ye(e,1)}return t=di(n,i.R(t)),new nr(i,t)}for(i=Ze;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(e)/Math.LN2))?1:Math.pow(2,r-48),o=(s=qt(e)).R(t);bt(o)||0<o.X(n);)o=(s=qt(e-=r)).R(t);Qt(s)&&(s=Zs),i=i.add(s),n=di(n,o)}return new nr(i,n)}function xc(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new B(e,n.h)}function Ye(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,i=[],s=0;s<r;s++)i[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new B(i,n.h)}(w=B.prototype).ea=function(){if(bt(this))return-mt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:Hs+r)*t,t*=Hs}return n},w.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Qt(this))return"0";if(bt(this))return"-"+mt(this).toString(n);for(var t=qt(Math.pow(n,6)),e=this,r="";;){var i=mi(e,t).g,s=((0<(e=di(e,i.R(t))).g.length?e.g[0]:e.h)>>>0).toString(n);if(Qt(e=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},w.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},w.X=function(n){return bt(n=di(this,n))?-1:Qt(n)?0:1},w.abs=function(){return bt(this)?mt(this):this},w.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,e[i]=(o&=65535)<<16|(s&=65535)}return new B(e,-2147483648&e[e.length-1]?-1:0)},w.R=function(n){if(Qt(this)||Qt(n))return Ze;if(bt(this))return bt(n)?mt(this).R(mt(n)):mt(mt(this).R(n));if(bt(n))return mt(this.R(mt(n)));if(0>this.X(Sc)&&0>n.X(Sc))return qt(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);e[2*r+2*i]+=o*u,fi(e,2*r+2*i),e[2*r+2*i+1]+=s*u,fi(e,2*r+2*i+1),e[2*r+2*i+1]+=o*a,fi(e,2*r+2*i+1),e[2*r+2*i+2]+=s*a,fi(e,2*r+2*i+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new B(e,0)},w.gb=function(n){return mi(this,n).h},w.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new B(e,this.h&n.h)},w.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new B(e,this.h|n.h)},w.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new B(e,this.h^n.h)},hi.prototype.createWebChannel=hi.prototype.g,St.prototype.send=St.prototype.u,St.prototype.open=St.prototype.m,St.prototype.close=St.prototype.close,Jr.NO_ERROR=0,Jr.TIMEOUT=8,Jr.HTTP_ERROR=6,Lu.COMPLETE="complete",Bu.EventType=Kn,Kn.OPEN="a",Kn.CLOSE="b",Kn.ERROR="c",Kn.MESSAGE="d",ct.prototype.listen=ct.prototype.O,X.prototype.listenOnce=X.prototype.P,X.prototype.getLastError=X.prototype.Sa,X.prototype.getLastErrorCode=X.prototype.Ia,X.prototype.getStatus=X.prototype.da,X.prototype.getResponseJson=X.prototype.Wa,X.prototype.getResponseText=X.prototype.ja,X.prototype.send=X.prototype.ha,X.prototype.setWithCredentials=X.prototype.Oa,Mt.prototype.digest=Mt.prototype.l,Mt.prototype.reset=Mt.prototype.reset,Mt.prototype.update=Mt.prototype.j,B.prototype.add=B.prototype.add,B.prototype.multiply=B.prototype.R,B.prototype.modulo=B.prototype.gb,B.prototype.compare=B.prototype.X,B.prototype.toNumber=B.prototype.ea,B.prototype.toString=B.prototype.toString,B.prototype.getBits=B.prototype.D,B.fromNumber=qt,B.fromString=function Vc(n,t){if(0==n.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==n.charAt(0))return mt(Vc(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=qt(Math.pow(t,8)),r=Ze,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),t);8>s?(s=qt(Math.pow(t,s)),r=r.R(s).add(qt(o))):r=(r=r.R(e)).add(qt(o))}return r};var tm=kt.createWebChannelTransport=function(){return new hi},em=kt.getStatEventTarget=function(){return Xr()},Ys=kt.ErrorCode=Jr,nm=kt.EventType=Lu,rm=kt.Event=Ee,Cc=kt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},gi=(kt.FetchXmlHttpFactory=Yn,kt.WebChannel=Bu),im=kt.XhrIo=X,sm=kt.Md5=Mt,Xe=kt.Integer=B;const bc="@firebase/firestore";class lt{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}lt.UNAUTHENTICATED=new lt(null),lt.GOOGLE_CREDENTIALS=new lt("google-credentials-uid"),lt.FIRST_PARTY=new lt("first-party-uid"),lt.MOCK_USER=new lt("mock-user");let Je="10.8.0";const ee=new Ft.Yd("@firebase/firestore");function tn(){return ee.logLevel}function om(n){ee.setLogLevel(n)}function y(n,...t){if(ee.logLevel<=Ft.in.DEBUG){const e=t.map(Xs);ee.debug(`Firestore (${Je}): ${n}`,...e)}}function nt(n,...t){if(ee.logLevel<=Ft.in.ERROR){const e=t.map(Xs);ee.error(`Firestore (${Je}): ${n}`,...e)}}function Rt(n,...t){if(ee.logLevel<=Ft.in.WARN){const e=t.map(Xs);ee.warn(`Firestore (${Je}): ${n}`,...e)}}function Xs(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function R(n="Unexpected state"){const t=`FIRESTORE (${Je}) INTERNAL ASSERTION FAILED: `+n;throw nt(t),new Error(t)}function P(n,t){n||R()}function am(n,t){n||R()}function E(n,t){return n}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _ extends q.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class st{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Dc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class um{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(lt.UNAUTHENTICATED))}shutdown(){}}class cm{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class lm{constructor(t){this.t=t,this.currentUser=lt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,e(c)):Promise.resolve();let o=new st;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new st,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;t.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new st)}},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P("string"==typeof r.accessToken),new Dc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return P(null===t||"string"==typeof t),new lt(t)}}class hm{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=lt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class dm{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new hm(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(lt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Nc{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fm{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const r=s=>{null!=s.error&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};const i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(P("string"==typeof e.token),this.R=e.token,new Nc(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function mm(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class kc{static newId(){const e=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=mm(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function C(n,t){return n<t?-1:n>t?1:0}function en(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function Mc(n){return n+"\0"}class Z{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Z.fromMillis(Date.now())}static fromDate(t){return Z.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new Z(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?C(this.nanoseconds,t.nanoseconds):C(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class V{constructor(t){this.timestamp=t}static fromTimestamp(t){return new V(t)}static min(){return new V(new Z(0,0))}static max(){return new V(new Z(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rr{constructor(t,e,r){void 0===e?e=0:e>t.length&&R(),void 0===r?r=t.length-e:r>t.length-e&&R(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return 0===rr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof rr?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let i=0;i<r;i++){const s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class F extends rr{construct(t,e,r){return new F(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new F(e)}static emptyPath(){return new F([])}}const gm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class W extends rr{construct(t,e,r){return new W(t,e,r)}static isValidIdentifier(t){return gm.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),W.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new W(["__name__"])}static fromServerFormat(t){const e=[];let r="",i=0;const s=()=>{if(0===r.length)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let o=!1;for(;i<t.length;){const a=t[i];if("\\"===a){if(i+1===t.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new W(e)}static emptyPath(){return new W([])}}class A{constructor(t){this.path=t}static fromPath(t){return new A(F.fromString(t))}static fromName(t){return new A(F.fromString(t).popFirst(5))}static empty(){return new A(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===F.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return F.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new A(new F(t.slice()))}}class nn{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}}function Js(n){return n.fields.find(t=>2===t.kind)}function Re(n){return n.fields.filter(t=>2!==t.kind)}nn.UNKNOWN_ID=-1;class Pe{constructor(t,e){this.fieldPath=t,this.kind=e}}class rn{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new rn(0,xt.min())}}function Fc(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=V.fromTimestamp(1e9===r?new Z(e+1,0):new Z(e,r));return new xt(i,A.empty(),t)}function Oc(n){return new xt(n.readTime,n.key,-1)}class xt{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new xt(V.min(),A.empty(),-1)}static max(){return new xt(V.max(),A.empty(),-1)}}function to(n,t){let e=n.readTime.compareTo(t.readTime);return 0!==e?e:(e=A.comparator(n.documentKey,t.documentKey),0!==e?e:C(n.largestBatchId,t.largestBatchId))}const Lc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class qc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}function ne(n){return eo.apply(this,arguments)}function eo(){return eo=(0,p.Z)(function*(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==Lc)throw n;y("LocalStore","Unexpectedly lost primary lease")}),eo.apply(this,arguments)}class f{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new f((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof f?e:f.resolve(e)}catch(e){return f.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):f.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):f.reject(e)}static resolve(t){return new f((e,r)=>{e(t)})}static reject(t){return new f((e,r)=>{r(t)})}static waitFor(t){return new f((e,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&e()},u=>r(u))}),o=!0,s===i&&e()})}static or(t){let e=f.resolve(!1);for(const r of t)e=e.next(i=>i?f.resolve(i):r());return e}static forEach(t,e){const r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new f((r,i)=>{const s=t.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;e(t[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,e){return new f((r,i)=>{const s=()=>{!0===t()?e().next(()=>{s()},i):r()};s()})}}class pi{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new st,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new ir(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=no(r.target.error);this.V.reject(new ir(t,i))}}static open(t,e,r,i){try{return new pi(e,t.transaction(i,r))}catch(s){throw new ir(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Im(e)}}class Dt{constructor(t,e,r){this.name=t,this.version=e,this.p=r,12.2===Dt.S((0,q.z$)())&&nt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return y("SimpleDb","Removing database:",t),Ve(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!(0,q.hl)())return!1;if(Dt.C())return!0;const t=(0,q.z$)(),e=Dt.S(t),r=0<e&&e<10,i=Dt.v(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){var e=this;return(0,p.Z)(function*(){return e.db||(y("SimpleDb","Opening database:",e.name),e.db=yield new Promise((r,i)=>{const s=indexedDB.open(e.name,e.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new ir(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new ir(t,a))},s.onupgradeneeded=o=>{y("SimpleDb",'Database "'+e.name+'" requires upgrade from version:',o.oldVersion),e.p.N(o.target.result,s.transaction,o.oldVersion,e.version).next(()=>{y("SimpleDb","Database upgrade to version "+e.version+" complete")})}})),e.B&&(e.db.onversionchange=r=>e.B(r)),e.db})()}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){var s=this;return(0,p.Z)(function*(){const o="readonly"===e;let a=0;for(;;){++a;try{s.db=yield s.O(t);const u=pi.open(s.db,t,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class ym{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Ve(this.k.delete())}}class ir extends _{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function re(n){return"IndexedDbTransactionError"===n.name}class Im{constructor(t){this.store=t}put(t,e){let r;return void 0!==e?(y("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Ve(r)}add(t){return y("SimpleDb","ADD",this.store.name,t,t),Ve(this.store.add(t))}get(t){return Ve(this.store.get(t)).next(e=>(void 0===e&&(e=null),y("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return y("SimpleDb","DELETE",this.store.name,t),Ve(this.store.delete(t))}count(){return y("SimpleDb","COUNT",this.store.name),Ve(this.store.count())}W(t,e){const r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new f((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(t,e){const r=this.store.getAll(t,null===e?void 0:e);return new f((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(t,e){y("SimpleDb","DELETE ALL",this.store.name);const r=this.options(t,e);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(t,e){let r;e?r=t:(r={},e=t);const i=this.cursor(r);return this.G(i,e)}Z(t){const e=this.cursor({});return new f((r,i)=>{e.onerror=s=>{const o=no(s.target.error);i(o)},e.onsuccess=s=>{const o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,e){const r=[];return new f((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new ym(a),c=e(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>f.waitFor(r))}options(t,e){let r;return void 0!==t&&("string"==typeof t?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ve(n){return new f((t,e)=>{n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{const i=no(r.target.error);e(i)}})}let Bc=!1;function no(n){const t=Dt.S((0,q.z$)());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){const r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Bc||(Bc=!0,setTimeout(()=>{throw r},0)),r}}return n}class Tm{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(t){var e=this;y("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(0,p.Z)(function*(){e.task=null;try{y("IndexBackfiller",`Documents written: ${yield e.X.te()}`)}catch(r){re(r)?y("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield ne(r)}yield e.ee(6e4)}))}}class Em{constructor(t,e){this.localStore=t,this.persistence=e}te(t=50){var e=this;return(0,p.Z)(function*(){return e.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>e.ne(r,t))})()}ne(t,e){const r=new Set;let i=e,s=!0;return f.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(null!==o&&!r.has(o))return y("IndexBackfiller",`Processing collection: ${o}`),this.re(t,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>e-i)}re(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ie(i,s)).next(a=>(y("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ie(t,e){let r=t;return e.changes.forEach((i,s)=>{const o=Oc(s);to(o,r)>0&&(r=o)}),new xt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}}let Ct=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function sr(n){return null==n}function or(n){return 0===n&&1/n==-1/0}function Uc(n){return"number"==typeof n&&Number.isInteger(n)&&!or(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Tt(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Gc(t)),t=vm(n.get(e),t);return Gc(t)}function vm(n,t){let e=t;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":e+="\x01\x10";break;case"\x01":e+="\x01\x11";break;default:e+=s}}return e}function Gc(n){return n+"\x01\x01"}function Bt(n){const t=n.length;if(P(t>=2),2===t)return P("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),F.emptyPath();const e=t-2,r=[];let i="";for(let s=0;s<t;){const o=n.indexOf("\x01",s);switch((o<0||o>e)&&R(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:R()}s=o+2}return new F(r)}const zc=["userId","batchId"];function _i(n,t){return[n,Tt(t)]}function Kc(n,t,e){return[n,Tt(t),e]}const Am={},wm=["prefixPath","collectionGroup","readTime","documentId"],Rm=["prefixPath","collectionGroup","documentId"],Pm=["collectionGroup","readTime","prefixPath","documentId"],Vm=["canonicalId","targetId"],Sm=["targetId","path"],xm=["path","targetId"],Cm=["collectionId","parent"],bm=["indexId","uid"],Dm=["uid","sequenceNumber"],Nm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],km=["indexId","uid","orderedDocumentKey"],Mm=["userId","collectionPath","documentId"],Fm=["userId","collectionPath","largestBatchId"],Om=["userId","collectionGroup","largestBatchId"],jc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Lm=[...jc,"documentOverlays"],Qc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],$c=Qc,qm=[...$c,"indexConfiguration","indexState","indexEntries"];class ro extends qc{constructor(t,e){super(),this.ae=t,this.currentSequenceNumber=e}}function ht(n,t){const e=E(n);return Dt.M(e.ae,t)}function Wc(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ie(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Hc(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class j{constructor(t,e){this.comparator=t,this.root=e||gt.EMPTY}insert(t,e){return new j(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,gt.BLACK,null,null))}remove(t){return new j(this.comparator,this.root.remove(t,this.comparator).copy(null,null,gt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(0===r)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(t,r.key);if(0===i)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){const t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new yi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new yi(this.root,t,this.comparator,!1)}getReverseIterator(){return new yi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new yi(this.root,t,this.comparator,!0)}}class yi{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class gt{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??gt.RED,this.left=i??gt.EMPTY,this.right=s??gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new gt(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this;const s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return gt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return gt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw R();const t=this.left.check();if(t!==this.right.check())throw R();return t+(this.isRed()?0:1)}}gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1,gt.EMPTY=new class{constructor(){this.size=0}get key(){throw R()}get value(){throw R()}get color(){throw R()}get left(){throw R()}get right(){throw R()}copy(t,e,r,i,s){return this}insert(t,e,r){return new gt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class z{constructor(t){this.comparator=t,this.data=new j(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Zc(this.data.getIterator())}getIteratorFrom(t){return new Zc(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof z)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new z(this.comparator);return e.data=t,e}}class Zc{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sn(n){return n.hasNext()?n.getNext():void 0}class Pt{constructor(t){this.fields=t,t.sort(W.comparator)}static empty(){return new Pt([])}unionWith(t){let e=new z(W.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new Pt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return en(this.fields,t.fields,(e,r)=>e.isEqual(r))}}class Yc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function Bm(){return typeof atob<"u"}class ot{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Yc("Invalid base64 string: "+s):s}}(t);return new ot(e)}static fromUint8Array(t){const e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new ot(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return C(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ot.EMPTY_BYTE_STRING=new ot("");const Um=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function se(n){if(P(!!n),"string"==typeof n){let t=0;const e=Um.exec(n);if(P(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:J(n.seconds),nanos:J(n.nanos)}}function J(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function $t(n){return"string"==typeof n?ot.fromBase64String(n):ot.fromUint8Array(n)}function Ii(n){var t,e;return"server_timestamp"===(null===(e=((null===(t=n?.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function Ti(n){const t=n.mapValue.fields.__previous_value__;return Ii(t)?Ti(t):t}function ar(n){const t=se(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(t.seconds,t.nanos)}class Gm{constructor(t,e,r,i,s,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class oe{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new oe("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof oe&&t.projectId===this.projectId&&t.database===this.database}}const ae={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ei={nullValue:"NULL_VALUE"};function ue(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ii(n)?4:el(n)?9007199254740991:10:R()}function Ut(n,t){if(n===t)return!0;const e=ue(n);if(e!==ue(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ar(n).isEqual(ar(t));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=se(i.timestampValue),a=se(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return s=t,$t(n.bytesValue).isEqual($t(s.bytesValue));case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return J(i.geoPointValue.latitude)===J(s.geoPointValue.latitude)&&J(i.geoPointValue.longitude)===J(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return J(i.integerValue)===J(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=J(i.doubleValue),a=J(s.doubleValue);return o===a?or(o)===or(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return en(n.arrayValue.values||[],t.arrayValue.values||[],Ut);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Wc(o)!==Wc(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!Ut(o[u],a[u])))return!1;return!0}(n,t);default:return R()}var s}function ur(n,t){return void 0!==(n.values||[]).find(e=>Ut(e,t))}function ce(n,t){if(n===t)return 0;const e=ue(n),r=ue(t);if(e!==r)return C(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return C(n.booleanValue,t.booleanValue);case 2:return function(s,o){const a=J(s.integerValue||s.doubleValue),u=J(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return Xc(n.timestampValue,t.timestampValue);case 4:return Xc(ar(n),ar(t));case 5:return C(n.stringValue,t.stringValue);case 6:return function(s,o){const a=$t(s),u=$t(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=C(a[c],u[c]);if(0!==l)return l}return C(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){const a=C(J(s.latitude),J(o.latitude));return 0!==a?a:C(J(s.longitude),J(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=ce(a[c],u[c]);if(l)return l}return C(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===ae.mapValue&&o===ae.mapValue)return 0;if(s===ae.mapValue)return 1;if(o===ae.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const d=C(u[h],l[h]);if(0!==d)return d;const m=ce(a[u[h]],c[l[h]]);if(0!==m)return m}return C(u.length,l.length)}(n.mapValue,t.mapValue);default:throw R()}}function Xc(n,t){if("string"==typeof n&&"string"==typeof t&&n.length===t.length)return C(n,t);const e=se(n),r=se(t),i=C(e.seconds,r.seconds);return 0!==i?i:C(e.nanos,r.nanos)}function on(n){return io(n)}function io(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){const r=se(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?$t(n.bytesValue).toBase64():"referenceValue"in n?A.fromName(n.referenceValue).toString():"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(const s of e.values||[])i?i=!1:r+=",",r+=io(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){const r=Object.keys(e.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${io(e.fields[o])}`;return i+"}"}(n.mapValue):R()}function Se(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function so(n){return!!n&&"integerValue"in n}function cr(n){return!!n&&"arrayValue"in n}function Jc(n){return!!n&&"nullValue"in n}function tl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ai(n){return!!n&&"mapValue"in n}function lr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return ie(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=lr(r)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=lr(n.arrayValue.values[e]);return t}return Object.assign({},n)}function el(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function zm(n){return"nullValue"in n?Ei:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Se(oe.empty(),A.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:R()}function Km(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Se(oe.empty(),A.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ae:R()}function nl(n,t){const e=ce(n.value,t.value);return 0!==e?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function rl(n,t){const e=ce(n.value,t.value);return 0!==e?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}class pt{constructor(t){this.value=t}static empty(){return new pt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ai(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=lr(e)}setAll(t){let e=W.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){const u=this.getFieldsMap(e);this.applyChanges(u,r,i),r={},i=[],e=a.popLast()}o?r[a.lastSegment()]=lr(o):i.push(a.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){const e=this.field(t.popLast());Ai(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ut(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Ai(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){ie(e,(i,s)=>t[i]=s);for(const i of r)delete t[i]}clone(){return new pt(lr(this.value))}}function il(n){const t=[];return ie(n.fields,(e,r)=>{const i=new W([e]);if(Ai(r)){const s=il(r.mapValue).fields;if(0===s.length)t.push(i);else for(const o of s)t.push(i.child(o))}else t.push(i)}),new Pt(t)}class H{constructor(t,e,r,i,s,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new H(t,0,V.min(),V.min(),V.min(),pt.empty(),0)}static newFoundDocument(t,e,r,i){return new H(t,1,e,V.min(),r,i,0)}static newNoDocument(t,e){return new H(t,2,e,V.min(),V.min(),pt.empty(),0)}static newUnknownDocument(t,e){return new H(t,3,e,V.min(),V.min(),pt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(V.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=pt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=V.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof H&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new H(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class le{constructor(t,e){this.position=t,this.inclusive=e}}function sl(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){const s=t[i],o=n.position[i];if(r=s.field.isKeyField()?A.comparator(A.fromName(o.referenceValue),e.key):ce(o,e.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ol(n,t){if(null===n)return null===t;if(null===t||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ut(n.position[e],t.position[e]))return!1;return!0}class hr{constructor(t,e="asc"){this.field=t,this.dir=e}}function jm(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class al{}class O extends al{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,r):new Qm(t,e,r):"array-contains"===e?new Hm(t,r):"in"===e?new fl(t,r):"not-in"===e?new Zm(t,r):"array-contains-any"===e?new Ym(t,r):new O(t,e,r)}static createKeyFieldInFilter(t,e,r){return"in"===e?new $m(t,r):new Wm(t,r)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ce(e,this.value)):null!==e&&ue(this.value)===ue(e)&&this.matchesComparison(ce(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return R()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class U extends al{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new U(t,e)}matches(t){return an(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function an(n){return"and"===n.op}function oo(n){return"or"===n.op}function ao(n){return ul(n)&&an(n)}function ul(n){for(const t of n.filters)if(t instanceof U)return!1;return!0}function uo(n){if(n instanceof O)return n.field.canonicalString()+n.op.toString()+on(n.value);if(ao(n))return n.filters.map(t=>uo(t)).join(",");{const t=n.filters.map(e=>uo(e)).join(",");return`${n.op}(${t})`}}function cl(n,t){return n instanceof O?(r=n,(i=t)instanceof O&&r.op===i.op&&r.field.isEqual(i.field)&&Ut(r.value,i.value)):n instanceof U?function(r,i){return i instanceof U&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&cl(o,i.filters[a]),!0)}(n,t):void R();var r,i}function ll(n,t){const e=n.filters.concat(t);return U.create(e,n.op)}function hl(n){return n instanceof O?`${(e=n).field.canonicalString()} ${e.op} ${on(e.value)}`:n instanceof U?function(e){return e.op.toString()+" {"+e.getFilters().map(hl).join(" ,")+"}"}(n):"Filter";var e}class Qm extends O{constructor(t,e,r){super(t,e,r),this.key=A.fromName(r.referenceValue)}matches(t){const e=A.comparator(t.key,this.key);return this.matchesComparison(e)}}class $m extends O{constructor(t,e){super(t,"in",e),this.keys=dl(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Wm extends O{constructor(t,e){super(t,"not-in",e),this.keys=dl(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function dl(n,t){var e;return((null===(e=t.arrayValue)||void 0===e?void 0:e.values)||[]).map(r=>A.fromName(r.referenceValue))}class Hm extends O{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return cr(e)&&ur(e.arrayValue,this.value)}}class fl extends O{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ur(this.value.arrayValue,e)}}class Zm extends O{constructor(t,e){super(t,"not-in",e)}matches(t){if(ur(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ur(this.value.arrayValue,e)}}class Ym extends O{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!cr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>ur(this.value.arrayValue,r))}}class Xm{constructor(t,e=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function co(n,t=null,e=[],r=[],i=null,s=null,o=null){return new Xm(n,t,e,r,i,s,o)}function xe(n){const t=E(n);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>uo(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),sr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>on(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>on(r)).join(",")),t.ce=e}return t.ce}function dr(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!jm(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!cl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!ol(n.startAt,t.startAt)&&ol(n.endAt,t.endAt)}function wi(n){return A.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Ri(n,t){return n.filters.filter(e=>e instanceof O&&e.field.isEqual(t))}function ml(n,t,e){let r=Ei,i=!0;for(const s of Ri(n,t)){let o=Ei,a=!0;switch(s.op){case"<":case"<=":o=zm(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ei}nl({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==e)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){const o=e.position[s];nl({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}return{value:r,inclusive:i}}function gl(n,t,e){let r=ae,i=!0;for(const s of Ri(n,t)){let o=ae,a=!0;switch(s.op){case">=":case">":o=Km(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=ae}rl({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==e)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){const o=e.position[s];rl({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}return{value:r,inclusive:i}}class Wt{constructor(t,e=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function pl(n,t,e,r,i,s,o,a){return new Wt(n,t,e,r,i,s,o,a)}function un(n){return new Wt(n)}function _l(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function lo(n){return null!==n.collectionGroup}function cn(n){const t=E(n);if(null===t.le){t.le=[];const e=new Set;for(const s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new z(W.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new hr(s,r))}),e.has(W.keyField().canonicalString())||t.le.push(new hr(W.keyField(),r))}return t.le}function wt(n){const t=E(n);return t.he||(t.he=function yl(n,t){if("F"===n.limitType)return co(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>new hr(i.field,"desc"===i.dir?"asc":"desc"));const e=n.endAt?new le(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new le(n.startAt.position,n.startAt.inclusive):null;return co(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}(t,cn(n))),t.he}function ho(n,t){const e=n.filters.concat([t]);return new Wt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Pi(n,t,e){return new Wt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function fr(n,t){return dr(wt(n),wt(t))&&n.limitType===t.limitType}function Il(n){return`${xe(wt(n))}|lt:${n.limitType}`}function ln(n){return`Query(target=${function(e){let r=e.path.canonicalString();return null!==e.collectionGroup&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>hl(i)).join(", ")}]`),sr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>on(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>on(i)).join(",")),`Target(${r})`}(wt(n))}; limitType=${n.limitType})`}function mr(n,t){return t.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):A.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(const s of cn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,t)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&(i=t,!((r=n).startAt&&!function(o,a,u){const c=sl(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,cn(r),i)||r.endAt&&!function(o,a,u){const c=sl(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,cn(r),i)));var r,i}function Tl(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function El(n){return(t,e)=>{let r=!1;for(const i of cn(n)){const s=Jm(i,t,e);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function Jm(n,t,e){const r=n.field.isKeyField()?A.comparator(t.key,e.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?ce(u,c):R()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}class Ht{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const r=this.mapKeyFn(t),i=this.inner[r];if(void 0===i)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return 1===r.length?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){ie(this.inner,(e,r)=>{for(const[i,s]of r)t(i,s)})}isEmpty(){return Hc(this.inner)}size(){return this.innerSize}}const tg=new j(A.comparator);function Vt(){return tg}const vl=new j(A.comparator);function gr(...n){let t=vl;for(const e of n)t=t.insert(e.key,e);return t}function Al(n){let t=vl;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Gt(){return pr()}function wl(){return pr()}function pr(){return new Ht(n=>n.toString(),(n,t)=>n.isEqual(t))}const eg=new j(A.comparator),ng=new z(A.comparator);function N(...n){let t=ng;for(const e of n)t=t.add(e);return t}const rg=new z(C);function fo(){return rg}function Rl(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:or(t)?"-0":t}}function Pl(n){return{integerValue:""+n}}function Vl(n,t){return Uc(t)?Pl(t):Rl(n,t)}class Vi{constructor(){this._=void 0}}function ig(n,t,e){return n instanceof hn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ii(s)&&(s=Ti(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof Ce?xl(n,t):n instanceof be?Cl(n,t):function(i,s){const o=Sl(i,s),a=bl(o)+bl(i.Ie);return so(o)&&so(i.Ie)?Pl(a):Rl(i.serializer,a)}(n,t)}function sg(n,t,e){return n instanceof Ce?xl(n,t):n instanceof be?Cl(n,t):e}function Sl(n,t){return n instanceof dn?so(r=t)||(s=r)&&"doubleValue"in s?t:{integerValue:0}:null;var r,s}class hn extends Vi{}class Ce extends Vi{constructor(t){super(),this.elements=t}}function xl(n,t){const e=Dl(t);for(const r of n.elements)e.some(i=>Ut(i,r))||e.push(r);return{arrayValue:{values:e}}}class be extends Vi{constructor(t){super(),this.elements=t}}function Cl(n,t){let e=Dl(t);for(const r of n.elements)e=e.filter(i=>!Ut(i,r));return{arrayValue:{values:e}}}class dn extends Vi{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function bl(n){return J(n.integerValue||n.doubleValue)}function Dl(n){return cr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class _r{constructor(t,e){this.field=t,this.transform=e}}class ag{constructor(t,e){this.version=t,this.transformResults=e}}class Y{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Y}static exists(t){return new Y(void 0,t)}static updateTime(t){return new Y(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Si(n,t){return void 0!==n.updateTime?t.isFoundDocument()&&t.version.isEqual(n.updateTime):void 0===n.exists||n.exists===t.isFoundDocument()}class xi{}function Nl(n,t){if(!n.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return n.isNoDocument()?new mn(n.key,Y.none()):new fn(n.key,n.data,Y.none());{const e=n.data,r=pt.empty();let i=new z(W.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);null===o&&s.length>1&&(s=s.popLast(),o=e.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new Zt(n.key,r,new Pt(i.toArray()),Y.none())}}function ug(n,t,e){n instanceof fn?function(i,s,o){const a=i.value.clone(),u=Fl(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Zt?function(i,s,o){if(!Si(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Fl(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Ml(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):t.convertToNoDocument(e.version).setHasCommittedMutations()}function yr(n,t,e,r){return n instanceof fn?function(s,o,a,u){if(!Si(s.precondition,o))return a;const c=s.value.clone(),l=Ol(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Zt?function(s,o,a,u){if(!Si(s.precondition,o))return a;const c=Ol(s.fieldTransforms,u,o),l=o.data;return l.setAll(Ml(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,r):(a=e,Si(n.precondition,o=t)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function cg(n,t){let e=null;for(const r of n.fieldTransforms){const i=t.data.field(r.field),s=Sl(r.transform,i||null);null!=s&&(null===e&&(e=pt.empty()),e.set(r.field,s))}return e||null}function kl(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&(i=t.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&en(r,i,(s,o)=>function og(n,t){return n.field.isEqual(t.field)&&(i=t.transform,(r=n.transform)instanceof Ce&&i instanceof Ce||r instanceof be&&i instanceof be?en(r.elements,i.elements,Ut):r instanceof dn&&i instanceof dn?Ut(r.Ie,i.Ie):r instanceof hn&&i instanceof hn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(t.value):1!==n.type||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask));var r,i}class fn extends xi{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Zt extends xi{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ml(n){const t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}}),t}function Fl(n,t,e){const r=new Map;P(n.length===e.length);for(let i=0;i<e.length;i++){const s=n[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,sg(o,a,e[i]))}return r}function Ol(n,t,e){const r=new Map;for(const i of n){const s=i.transform,o=e.data.field(i.field);r.set(i.field,ig(s,o,t))}return r}class mn extends xi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mo extends xi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class go{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(t.key)&&ug(s,t,r[i])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=yr(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=yr(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=wl();return this.mutations.forEach(i=>{const s=t.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=e.has(i.key)?null:a;const u=Nl(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(V.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),N())}isEqual(t){return this.batchId===t.batchId&&en(this.mutations,t.mutations,(e,r)=>kl(e,r))&&en(this.baseMutations,t.baseMutations,(e,r)=>kl(e,r))}}class po{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){P(t.mutations.length===r.length);let i=function(){return eg}();const s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new po(t,e,r,i)}}class _o{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class hg{constructor(t,e){this.count=t,this.unchangedNames=e}}var it,L;function Ll(n){switch(n){default:return R();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function ql(n){if(void 0===n)return nt("GRPC error has no .code"),g.UNKNOWN;switch(n){case it.OK:return g.OK;case it.CANCELLED:return g.CANCELLED;case it.UNKNOWN:return g.UNKNOWN;case it.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case it.INTERNAL:return g.INTERNAL;case it.UNAVAILABLE:return g.UNAVAILABLE;case it.UNAUTHENTICATED:return g.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case it.NOT_FOUND:return g.NOT_FOUND;case it.ALREADY_EXISTS:return g.ALREADY_EXISTS;case it.PERMISSION_DENIED:return g.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case it.ABORTED:return g.ABORTED;case it.OUT_OF_RANGE:return g.OUT_OF_RANGE;case it.UNIMPLEMENTED:return g.UNIMPLEMENTED;case it.DATA_LOSS:return g.DATA_LOSS;default:return R()}}(L=it||(it={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";function Bl(){return new TextEncoder}const dg=new Xe([4294967295,4294967295],0);function Ul(n){const t=Bl().encode(n),e=new sm;return e.update(t),new Uint8Array(e.digest())}function Gl(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Xe([e,r],0),new Xe([i,s],0)]}class yo{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Ir(`Invalid padding: ${e}`);if(r<0)throw new Ir(`Invalid hash count: ${r}`);if(t.length>0&&0===this.hashCount)throw new Ir(`Invalid hash count: ${r}`);if(0===t.length&&0!==e)throw new Ir(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Xe.fromNumber(this.Te)}de(t,e,r){let i=t.add(e.multiply(Xe.fromNumber(r)));return 1===i.compare(dg)&&(i=new Xe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Ul(t),[r,i]=Gl(e);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(t,e,r){const i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new yo(s,i,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(0===this.Te)return;const e=Ul(t),[r,i]=Gl(e);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(t){const e=Math.floor(t/8);this.bitmap[e]|=1<<t%8}}class Ir extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Tr{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const i=new Map;return i.set(t,Er.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new Tr(V.min(),i,new j(C),Vt(),N())}}class Er{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new Er(r,e,N(),N(),N())}}class bi{constructor(t,e,r,i){this.Ve=t,this.removedTargetIds=e,this.key=r,this.me=i}}class zl{constructor(t,e){this.targetId=t,this.fe=e}}class Kl{constructor(t,e,r=ot.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}}class jl{constructor(){this.ge=0,this.pe=$l(),this.ye=ot.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=N(),e=N(),r=N();return this.pe.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:R()}}),new Er(this.ye,this.we,t,e,r)}Fe(){this.Se=!1,this.pe=$l()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,P(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class fg{constructor(t){this.Le=t,this.ke=new Map,this.qe=Vt(),this.Qe=Ql(),this.Ke=new j(C)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{const r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(e);break;case 3:this.je(e)&&(r.Be(),r.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.Ce(t.resumeToken));break;default:R()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((r,i)=>{this.je(i)&&e(i)})}Je(t){const e=t.targetId,r=t.fe.count,i=this.Ye(e);if(i){const s=i.target;if(wi(s))if(0===r){const o=new A(s.path);this.We(e,o,H.newNoDocument(o,V.min()))}else P(1===r);else{const o=this.Ze(e);if(o!==r){const a=this.Xe(t),u=a?this.et(a,t,o):1;0!==u&&(this.He(e),this.Ke=this.Ke.insert(e,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e;let o,a;try{o=$t(r).toUint8Array()}catch(u){if(u instanceof Yc)return Rt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new yo(o,i,s)}catch(u){return Rt(u instanceof Ir?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(t,e,r){return e.fe.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){const r=this.Le.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),i++)}),i}it(t){const e=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&wi(a.target)){const u=new A(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,H.newNoDocument(u,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let r=N();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));const i=new Tr(t,e,this.Ke,this.qe,r);return this.qe=Vt(),this.Qe=Ql(),this.Ke=new j(C),i}Ue(t,e){if(!this.je(t))return;const r=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,r),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,r){if(!this.je(t))return;const i=this.ze(t);this.st(t,e)?i.Me(e,1):i.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),r&&(this.qe=this.qe.insert(e,r))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new jl,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new z(C),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||y("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new jl),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Ql(){return new j(A.comparator)}function $l(){return new j(A.comparator)}const mg={asc:"ASCENDING",desc:"DESCENDING"},gg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pg={and:"AND",or:"OR"};class _g{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Io(n,t){return n.useProto3Json||sr(t)?t:{value:t}}function gn(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function yg(n,t){return gn(n,t.toTimestamp())}function rt(n){return P(!!n),V.fromTimestamp(function(e){const r=se(e);return new Z(r.seconds,r.nanos)}(n))}function To(n,t){return Eo(n,t).canonicalString()}function Eo(n,t){const e=(i=n,new F(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===t?e:e.child(t)}function Hl(n){const t=F.fromString(n);return P(sh(t)),t}function vr(n,t){return To(n.databaseId,t.path)}function zt(n,t){const e=Hl(t);if(e.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new A(Xl(e))}function Zl(n,t){return To(n.databaseId,t)}function Yl(n){const t=Hl(n);return 4===t.length?F.emptyPath():Xl(t)}function vo(n){return new F(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Xl(n){return P(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Jl(n,t,e){return{name:vr(n,t),fields:e.value.mapValue.fields}}function th(n,t,e){const r=zt(n,t.name),i=rt(t.updateTime),s=t.createTime?rt(t.createTime):V.min(),o=new pt({mapValue:{fields:t.fields}}),a=H.newFoundDocument(r,i,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function Ar(n,t){let e;if(t instanceof fn)e={update:Jl(n,t.key,t.value)};else if(t instanceof mn)e={delete:vr(n,t.key)};else if(t instanceof Zt)e={update:Jl(n,t.key,t.data),updateMask:Pg(t.fieldMask)};else{if(!(t instanceof mo))return R();e={verify:vr(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof hn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ce)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof be)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof dn)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw R()}(0,r))),t.precondition.isNone||(e.currentDocument=void 0!==(s=t.precondition).updateTime?{updateTime:yg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:R()),e;var s}function Ao(n,t){const e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?Y.updateTime(rt(s.updateTime)):void 0!==s.exists?Y.exists(s.exists):Y.none():Y.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(P("REQUEST_TIME"===a.setToServerValue),u=new hn):"appendMissingElements"in a?u=new Ce(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new be(a.removeAllFromArray.values||[]):"increment"in a?u=new dn(o,a.increment):R();const c=W.fromServerFormat(a.fieldPath);return new _r(c,u)}(n,i)):[];var s;if(t.update){const i=zt(n,t.update.name),s=new pt({mapValue:{fields:t.update.fields}});if(t.updateMask){const o=new Pt((t.updateMask.fieldPaths||[]).map(l=>W.fromServerFormat(l)));return new Zt(i,s,o,e,r)}return new fn(i,s,e,r)}if(t.delete){const i=zt(n,t.delete);return new mn(i,e)}if(t.verify){const i=zt(n,t.verify);return new mo(i,e)}return R()}function eh(n,t){return{documents:[Zl(n,t.path)]}}function wo(n,t){const e={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Zl(n,i);const s=function(c){if(0!==c.length)return ih(U.create(c,"and"))}(t.filters);s&&(e.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(l=>{return{field:he((d=l).field),direction:Ag(d.dir)};var d})}(t.orderBy);o&&(e.structuredQuery.orderBy=o);const a=Io(n,t.limit);return null!==a&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{ut:e,parent:i};var c}function nh(n){let t=Yl(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let i=null;if(r>0){P(1===r);const l=e.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){const d=rh(h);return d instanceof U&&ao(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=e.orderBy.map(d=>{return new hr(pn((I=d).field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction));var I}));let a=null;e.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,sr(d)?null:d}(e.limit));let u=null;var h;e.startAt&&(u=new le((h=e.startAt).values||[],!!h.before));let c=null;return e.endAt&&(c=function(h){return new le(h.values||[],!h.before)}(e.endAt)),pl(t,i,o,s,a,"F",u,c)}function rh(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=pn(e.unaryFilter.field);return O.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=pn(e.unaryFilter.field);return O.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=pn(e.unaryFilter.field);return O.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=pn(e.unaryFilter.field);return O.create(o,"!=",{nullValue:"NULL_VALUE"});default:return R()}}(n):void 0!==n.fieldFilter?O.create(pn((e=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return U.create(e.compositeFilter.filters.map(r=>rh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return R()}}(e.compositeFilter.op))}(n):R();var e}function Ag(n){return mg[n]}function wg(n){return gg[n]}function Rg(n){return pg[n]}function he(n){return{fieldPath:n.canonicalString()}}function pn(n){return W.fromServerFormat(n.fieldPath)}function ih(n){return n instanceof O?function(e){if("=="===e.op){if(tl(e.value))return{unaryFilter:{field:he(e.field),op:"IS_NAN"}};if(Jc(e.value))return{unaryFilter:{field:he(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(tl(e.value))return{unaryFilter:{field:he(e.field),op:"IS_NOT_NAN"}};if(Jc(e.value))return{unaryFilter:{field:he(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:he(e.field),op:wg(e.op),value:e.value}}}(n):n instanceof U?function(e){const r=e.getFilters().map(i=>ih(i));return 1===r.length?r[0]:{compositeFilter:{op:Rg(e.op),filters:r}}}(n):R()}function Pg(n){const t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function sh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Yt{constructor(t,e,r,i,s=V.min(),o=V.min(),a=ot.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new Yt(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Yt(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Yt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Yt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class oh{constructor(t){this.ct=t}}function ah(n,t){const e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Di(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:vr(s=n.ct,(o=t).key),fields:o.data.value.mapValue.fields,updateTime:gn(s,o.version.toTimestamp()),createTime:gn(s,o.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:De(t.version)};else{if(!t.isUnknownDocument())return R();r.unknownDocument={path:e.path.toArray(),version:De(t.version)}}var s,o;return r}function Di(n){const t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function De(n){const t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ne(n){const t=new Z(n.seconds,n.nanoseconds);return V.fromTimestamp(t)}function ke(n,t){const e=(t.baseMutations||[]).map(s=>Ao(n.ct,s));for(let s=0;s<t.mutations.length-1;++s)s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform&&(t.mutations[s].updateTransforms=t.mutations[s+1].transform.fieldTransforms,t.mutations.splice(s+1,1),++s);const r=t.mutations.map(s=>Ao(n.ct,s)),i=Z.fromMillis(t.localWriteTimeMs);return new go(t.batchId,i,e,r)}function wr(n){const t=Ne(n.readTime),e=void 0!==n.lastLimboFreeSnapshotVersion?Ne(n.lastLimboFreeSnapshotVersion):V.min();let r;return r=void 0!==n.query.documents?(P(1===(s=n.query).documents.length),wt(un(Yl(s.documents[0])))):function(s){return wt(nh(s))}(n.query),new Yt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,ot.fromBase64String(n.resumeToken));var s}function uh(n,t){const e=De(t.snapshotVersion),r=De(t.lastLimboFreeSnapshotVersion);let i;i=wi(t.target)?eh(n.ct,t.target):wo(n.ct,t.target).ut;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:xe(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ro(n){const t=nh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Pi(t,t.limit,"L"):t}function Po(n,t){return new _o(t.largestBatchId,Ao(n.ct,t.overlayMutation))}function ch(n,t){const e=t.path.lastSegment();return[n,Tt(t.path.popLast()),e]}function lh(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:De(r.readTime),documentKey:Tt(r.documentKey.path),largestBatchId:r.largestBatchId}}class Sg{getBundleMetadata(t,e){return hh(t).get(e).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Ne(s.createTime),version:s.version};var s})}saveBundleMetadata(t,e){return hh(t).put({bundleId:(i=e).id,createTime:De(rt(i.createTime)),version:i.version});var i}getNamedQuery(t,e){return dh(t).get(e).next(r=>{if(r)return{name:(s=r).name,query:Ro(s.bundledQuery),readTime:Ne(s.readTime)};var s})}saveNamedQuery(t,e){return dh(t).put({name:(i=e).name,readTime:De(rt(i.readTime)),bundledQuery:i.bundledQuery});var i}}function hh(n){return ht(n,"bundles")}function dh(n){return ht(n,"namedQueries")}class Ni{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){return new Ni(t,e.uid||"")}getOverlay(t,e){return Rr(t).get(ch(this.userId,e)).next(r=>r?Po(this.serializer,r):null)}getOverlays(t,e){const r=Gt();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){const i=[];return r.forEach((s,o)=>{const a=new _o(e,o);i.push(this.ht(t,a))}),f.waitFor(i)}removeOverlaysForBatchId(t,e,r){const i=new Set;e.forEach(o=>i.add(Tt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Rr(t).H("collectionPathOverlayIndex",a))}),f.waitFor(s)}getOverlaysForCollection(t,e,r){const i=Gt(),s=Tt(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Rr(t).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Po(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(t,e,r,i){const s=Gt();let o;const a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Rr(t).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=Po(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(t,e){return Rr(t).put(function(i,s,o){const[a,u,c]=ch(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ar(i.ct,o.mutation)}}(this.serializer,this.userId,e))}}function Rr(n){return ht(n,"documentOverlays")}class Me{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(J(t.integerValue));else if("doubleValue"in t){const r=J(t.doubleValue);isNaN(r)?this.Et(e,13):(this.Et(e,15),or(r)?e.dt(0):e.dt(r))}else if("timestampValue"in t){const r=t.timestampValue;this.Et(e,20),"string"==typeof r?e.At(r):(e.At(`${r.seconds||""}`),e.dt(r.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft($t(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const r=t.geoPointValue;this.Et(e,45),e.dt(r.latitude||0),e.dt(r.longitude||0)}else"mapValue"in t?el(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):R()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const r=t.fields||{};this.Et(e,55);for(const i of Object.keys(r))this.Rt(i,e),this.It(r[i],e)}wt(t,e){const r=t.values||[];this.Et(e,50);for(const i of r)this.It(i,e)}gt(t,e){this.Et(e,37),A.fromName(t).path.forEach(r=>{this.Et(e,60),this.St(r,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}function xg(n){if(0===n)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function fh(n){const t=64-function(r){let i=0;for(let s=0;s<8;++s){const o=xg(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(t/8)}Me.bt=new Me;class Cg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){const e=t[Symbol.iterator]();let r=e.next();for(;!r.done;)this.Ct(r.value),r=e.next();this.vt()}Ft(t){const e=t[Symbol.iterator]();let r=e.next();for(;!r.done;)this.Mt(r.value),r=e.next();this.xt()}Ot(t){for(const e of t){const r=e.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(e<"\ud800"||"\udbff"<e)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{const i=e.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(t){for(const e of t){const r=e.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(e<"\ud800"||"\udbff"<e)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{const i=e.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Bt(t){const e=this.Lt(t),r=fh(e);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}qt(t){const e=this.Lt(t),r=fh(e);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Lt(t){const e=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=0!=(128&e[0]);e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Ct(t){const e=255&t;0===e?(this.Kt(0),this.Kt(255)):255===e?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){const e=255&t;0===e?(this.Ut(0),this.Ut(255)):255===e?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){const e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class bg{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Bt(t)}Tt(){this.Gt.Qt()}}class Dg{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}}class Pr{constructor(){this.Gt=new Cg,this.zt=new bg(this.Gt),this.jt=new Dg(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return 0===t?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class Fe{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Jt(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new Fe(this.indexId,this.documentKey,this.arrayValue,r)}}function de(n,t){let e=n.indexId-t.indexId;return 0!==e?e:(e=mh(n.arrayValue,t.arrayValue),0!==e?e:(e=mh(n.directionalValue,t.directionalValue),0!==e?e:A.comparator(n.documentKey,t.documentKey)))}function mh(n,t){for(let e=0;e<n.length&&e<t.length;++e){const r=n[e]-t[e];if(0!==r)return r}return n.length-t.length}class gh{constructor(t){this.Yt=new z((e,r)=>W.comparator(e.field,r.field)),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(const e of t.filters){const r=e;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(t){if(P(t.collectionGroup===this.collectionId),this.en)return!1;const e=Js(t);if(void 0!==e&&!this.nn(e))return!1;const r=Re(t);let i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){const a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Zt.length||!this.sn(this.Zt[o++],r[s]))return!1;return!0}on(){if(this.en)return null;let t=new z(W.comparator);const e=[];for(const r of this.Xt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)e.push(new Pe(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new Pe(r.field,0))}for(const r of this.Zt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new Pe(r.field,"asc"===r.dir?0:1)));return new nn(nn.UNKNOWN_ID,this.collectionId,e,rn.empty())}nn(t){for(const e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){return!(void 0===t||!t.field.isEqual(e.fieldPath))&&2===e.kind==("array-contains"===t.op||"array-contains-any"===t.op)}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function ph(n){var t,e;if(P(n instanceof O||n instanceof U),n instanceof O){if(n instanceof fl){const i=(null===(e=null===(t=n.value.arrayValue)||void 0===t?void 0:t.values)||void 0===e?void 0:e.map(s=>O.create(n.field,"==",s)))||[];return U.create(i,"or")}return n}const r=n.filters.map(i=>ph(i));return U.create(r,n.op)}function Ng(n){if(0===n.getFilters().length)return[];const t=xo(ph(n));return P(_h(t)),Vo(t)||So(t)?[t]:t.getFilters()}function Vo(n){return n instanceof O}function So(n){return n instanceof U&&ao(n)}function _h(n){return Vo(n)||So(n)||function(e){if(e instanceof U&&oo(e)){for(const r of e.getFilters())if(!Vo(r)&&!So(r))return!1;return!0}return!1}(n)}function xo(n){if(P(n instanceof O||n instanceof U),n instanceof O)return n;if(1===n.filters.length)return xo(n.filters[0]);const t=n.filters.map(r=>xo(r));let e=U.create(t,n.op);return e=ki(e),_h(e)?e:(P(e instanceof U),P(an(e)),P(e.filters.length>1),e.filters.reduce((r,i)=>Co(r,i)))}function Co(n,t){let e;return P(n instanceof O||n instanceof U),P(t instanceof O||t instanceof U),e=n instanceof O?t instanceof O?U.create([n,t],"and"):yh(n,t):t instanceof O?yh(t,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),an(i)&&an(s))return ll(i,s.getFilters());const o=oo(i)?i:s,a=oo(i)?s:i,u=o.filters.map(c=>Co(c,a));return U.create(u,"or")}(n,t),ki(e)}function yh(n,t){if(an(t))return ll(t,n.getFilters());{const e=t.filters.map(r=>Co(n,r));return U.create(e,"or")}}function ki(n){if(P(n instanceof O||n instanceof U),n instanceof O)return n;const t=n.getFilters();if(1===t.length)return ki(t[0]);if(ul(n))return n;const e=t.map(i=>ki(i)),r=[];return e.forEach(i=>{i instanceof O?r.push(i):i instanceof U&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:U.create(r,n.op)}class kg{constructor(){this._n=new bo}addToCollectionParentIndex(t,e){return this._n.add(e),f.resolve()}getCollectionParents(t,e){return f.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return f.resolve()}deleteFieldIndex(t,e){return f.resolve()}deleteAllFieldIndexes(t){return f.resolve()}createTargetIndexes(t,e){return f.resolve()}getDocumentsMatchingTarget(t,e){return f.resolve(null)}getIndexType(t,e){return f.resolve(0)}getFieldIndexes(t,e){return f.resolve([])}getNextCollectionGroupToUpdate(t){return f.resolve(null)}getMinOffset(t,e){return f.resolve(xt.min())}getMinOffsetFromCollectionGroup(t,e){return f.resolve(xt.min())}updateCollectionGroup(t,e,r){return f.resolve()}updateIndexEntries(t,e){return f.resolve()}}class bo{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new z(F.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new z(F.comparator)).toArray()}}const Mi=new Uint8Array(0);class Mg{constructor(t,e){this.databaseId=e,this.an=new bo,this.un=new Ht(r=>xe(r),(r,i)=>dr(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){const r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});const s={collectionId:r,parent:Tt(i)};return Ih(t).put(s)}return f.resolve()}getCollectionParents(t,e){const r=[],i=IDBKeyRange.bound([e,""],[Mc(e),""],!1,!0);return Ih(t).W(i).next(s=>{for(const o of s){if(o.collectionId!==e)break;r.push(Bt(o.parent))}return r})}addFieldIndex(t,e){const r=Vr(t),i={indexId:(a=e).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(e.indexState){const o=yn(t);return s.next(a=>{o.put(lh(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){const r=Vr(t),i=yn(t),s=_n(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){const e=Vr(t),r=_n(t),i=yn(t);return e.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(t,e){return f.forEach(this.cn(e),r=>this.getIndexType(t,r).next(i=>{if(0===i||1===i){const s=new gh(r).on();if(null!=s)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){const r=_n(t);let i=!0;const s=new Map;return f.forEach(this.cn(e),o=>this.ln(t,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=N();const a=[];return f.forEach(s,(u,c)=>{var x;y("IndexedDbIndexManager",`Using index ${x=u,`id=${x.indexId}|cg=${x.collectionGroup}|f=${x.fields.map(k=>`${k.fieldPath}:${k.kind}`).join(",")}`} to execute ${xe(e)}`);const l=function(x,k){const K=Js(k);if(void 0===K)return null;for(const G of Ri(x,K.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(c,u),h=function(x,k){const K=new Map;for(const G of Re(k))for(const at of Ri(x,G.fieldPath))switch(at.op){case"==":case"in":K.set(G.fieldPath.canonicalString(),at.value);break;case"not-in":case"!=":return K.set(G.fieldPath.canonicalString(),at.value),Array.from(K.values())}return null}(c,u),d=function(x,k){const K=[];let G=!0;for(const at of Re(k)){const Nt=0===at.kind?ml(x,at.fieldPath,x.startAt):gl(x,at.fieldPath,x.startAt);K.push(Nt.value),G&&(G=Nt.inclusive)}return new le(K,G)}(c,u),m=function(x,k){const K=[];let G=!0;for(const at of Re(k)){const Nt=0===at.kind?gl(x,at.fieldPath,x.endAt):ml(x,at.fieldPath,x.endAt);K.push(Nt.value),G&&(G=Nt.inclusive)}return new le(K,G)}(c,u),I=this.hn(u,c,d),v=this.hn(u,c,m),T=this.Pn(u,c,h),S=this.In(u.indexId,l,I,d.inclusive,v,m.inclusive,T);return f.forEach(S,D=>r.j(D,e.limit).next(x=>{x.forEach(k=>{const K=A.fromSegments(k.documentKey);o.has(K)||(o=o.add(K),a.push(K))})}))}).next(()=>a)}return f.resolve(null)})}cn(t){let e=this.un.get(t);return e||(e=0===t.filters.length?[t]:Ng(U.create(t.filters,"and")).map(r=>co(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,r,i,s,o,a){const u=(null!=e?e.length:1)*Math.max(r.length,s.length),c=u/(null!=e?e.length:1),l=[];for(let h=0;h<u;++h){const d=e?this.Tn(e[h/c]):Mi,m=this.En(t,d,r[h%c],i),I=this.dn(t,d,s[h%c],o),v=a.map(T=>this.En(t,d,T,!0));l.push(...this.createRange(m,I,v))}return l}En(t,e,r,i){const s=new Fe(t,A.empty(),e,r);return i?s:s.Jt()}dn(t,e,r,i){const s=new Fe(t,A.empty(),e,r);return i?s.Jt():s}ln(t,e){const r=new gh(e),i=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(const a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2;const i=this.cn(e);return f.forEach(i,s=>this.ln(t,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new z(W.comparator),l=!1;for(const h of u.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||("array-contains"===d.op||"array-contains-any"===d.op?l=!0:c=c.add(d.field));for(const h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==e.limit&&i.length>1&&2===r?1:r)}An(t,e){const r=new Pr;for(const i of Re(t)){const s=e.data.field(i.fieldPath);if(null==s)return null;const o=r.Ht(i.kind);Me.bt.Pt(s,o)}return r.Wt()}Tn(t){const e=new Pr;return Me.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){const r=new Pr;return Me.bt.Pt(Se(this.databaseId,e),r.Ht(function(s){const o=Re(s);return 0===o.length?0:o[o.length-1].kind}(t))),r.Wt()}Pn(t,e,r){if(null===r)return[];let i=[];i.push(new Pr);let s=0;for(const o of Re(t)){const a=r[s++];for(const u of i)if(this.Vn(e,o.fieldPath)&&cr(a))i=this.mn(i,o,a);else{const c=u.Ht(o.kind);Me.bt.Pt(a,c)}}return this.fn(i)}hn(t,e,r){return this.Pn(t,e,r.position)}fn(t){const e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Wt();return e}mn(t,e,r){const i=[...t],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new Pr;u.seed(a.Wt()),Me.bt.Pt(o,u.Ht(e.kind)),s.push(u)}return s}Vn(t,e){return!!t.filters.find(r=>r instanceof O&&r.field.isEqual(e)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(t,e){const r=Vr(t),i=yn(t);return(e?r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.W()).next(s=>{const o=[];return f.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){const d=h?new rn(h.sequenceNumber,new xt(Ne(h.readTime),new A(Bt(h.documentKey)),h.largestBatchId)):rn.empty(),m=l.fields.map(([I,v])=>new Pe(W.fromServerFormat(I),v));return new nn(l.indexId,l.collectionGroup,m,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>0===e.length?null:(e.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:C(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){const i=Vr(t),s=yn(t);return this.gn(t).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>f.forEach(a,u=>s.put(lh(u.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){const r=new Map;return f.forEach(e,(i,s)=>{const o=r.get(i.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),f.forEach(a,u=>this.pn(t,i,u).next(c=>{const l=this.yn(s,u);return c.isEqual(l)?f.resolve():this.wn(t,s,u,c,l)}))))})}Sn(t,e,r,i){return _n(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,e.key),documentKey:e.key.path.toArray()})}bn(t,e,r,i){return _n(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,e.key),e.key.path.toArray()])}pn(t,e,r){const i=_n(t);let s=new z(de);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,e)])},(o,a)=>{s=s.add(new Fe(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(t,e){let r=new z(de);const i=this.An(e,t);if(null==i)return r;const s=Js(e);if(null!=s){const o=t.data.field(s.fieldPath);if(cr(o))for(const a of o.arrayValue.values||[])r=r.add(new Fe(e.indexId,t.key,this.Tn(a),i))}else r=r.add(new Fe(e.indexId,t.key,Mi,i));return r}wn(t,e,r,i,s){y("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const o=[];return function(u,c,l,h,d){const m=u.getIterator(),I=c.getIterator();let v=sn(m),T=sn(I);for(;v||T;){let S=!1,D=!1;if(v&&T){const x=l(v,T);x<0?D=!0:x>0&&(S=!0)}else null!=v?D=!0:S=!0;S?(h(T),T=sn(I)):D?(d(v),v=sn(m)):(v=sn(m),T=sn(I))}}(i,s,de,a=>{o.push(this.Sn(t,e,r,a))},a=>{o.push(this.bn(t,e,r,a))}),f.waitFor(o)}gn(t){let e=1;return yn(t).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>de(o,a)).filter((o,a,u)=>!a||0!==de(o,u[a-1]));const i=[];i.push(t);for(const o of r){const a=de(o,t),u=de(o,e);if(0===a)i[0]=t.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(e);const s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Mi,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Mi,[]]))}return s}Dn(t,e){return de(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Th)}getMinOffset(t,e){return f.mapArray(this.cn(e),r=>this.ln(t,r).next(i=>i||R())).next(Th)}}function Ih(n){return ht(n,"collectionParents")}function _n(n){return ht(n,"indexEntries")}function Vr(n){return ht(n,"indexConfiguration")}function yn(n){return ht(n,"indexState")}function Th(n){P(0!==n.length);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;to(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new xt(t.readTime,t.documentKey,e)}const Eh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Et{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new Et(t,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function vh(n,t,e){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId);let a=0;const u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(1===a)}));const c=[];for(const l of e.mutations){const h=Kc(t,l.key.path,e.batchId);s.push(i.delete(h)),c.push(l.key)}return f.waitFor(s).next(()=>c)}function Fi(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw R();t=n.noDocument}return JSON.stringify(t).length}Et.DEFAULT_COLLECTION_PERCENTILE=10,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Et.DEFAULT=new Et(41943040,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Et.DISABLED=new Et(-1,0,0);class Oi{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(t,e,r,i){P(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new Oi(s,e,r,i)}checkEmpty(t){let e=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fe(t).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){const s=In(t),o=fe(t);return o.add({}).next(a=>{P("number"==typeof a);const u=new go(a,e,r,i),c=function(m,I,v){const T=v.baseMutations.map(D=>Ar(m.ct,D)),S=v.mutations.map(D=>Ar(m.ct,D));return{userId:I,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:T,mutations:S}}(this.serializer,this.userId,u),l=[];let h=new z((d,m)=>C(d.canonicalString(),m.canonicalString()));for(const d of i){const m=Kc(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(m,Am))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return fe(t).get(e).next(r=>r?(P(r.userId===this.userId),ke(this.serializer,r)):null)}vn(t,e){return this.Cn[e]?f.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){const i=r.keys();return this.Cn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){const r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return fe(t).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=ke(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return fe(t).Y({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fe(t).W("userMutationsIndex",e).next(r=>r.map(i=>ke(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){const r=_i(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return In(t).Y({range:i},(o,a,u)=>{const[c,l,h]=o,d=Bt(l);if(c===this.userId&&e.path.isEqual(d))return fe(t).get(h).next(m=>{if(!m)throw R();P(m.userId===this.userId),s.push(ke(this.serializer,m))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new z(C);const i=[];return e.forEach(s=>{const o=_i(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=In(t).Y({range:a},(c,l,h)=>{const[d,m,I]=c,v=Bt(m);d===this.userId&&s.path.isEqual(v)?r=r.add(I):h.done()});i.push(u)}),f.waitFor(i).next(()=>this.Fn(t,r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,i=r.length+1,s=_i(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new z(C);return In(t).Y({range:o},(u,c,l)=>{const[h,d,m]=u,I=Bt(d);h===this.userId&&r.isPrefixOf(I)?I.length===i&&(a=a.add(m)):l.done()}).next(()=>this.Fn(t,a))}Fn(t,e){const r=[],i=[];return e.forEach(s=>{i.push(fe(t).get(s).next(o=>{if(null===o)throw R();P(o.userId===this.userId),r.push(ke(this.serializer,o))}))}),f.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return vh(t.ae,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),f.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return f.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return In(t).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=Bt(s[1]);i.push(u)}else a.done()}).next(()=>{P(0===i.length)})})}containsKey(t,e){return Ah(t,this.userId,e)}xn(t){return wh(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ah(n,t,e){const r=_i(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return In(n).Y({range:s,J:!0},(a,u,c)=>{const[l,h,d]=a;l===t&&h===i&&(o=!0),c.done()}).next(()=>o)}function fe(n){return ht(n,"mutations")}function In(n){return ht(n,"documentMutations")}function wh(n){return ht(n,"mutationQueues")}class Oe{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Oe(0)}static Bn(){return new Oe(-1)}}class Fg{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Ln(t).next(e=>{const r=new Oe(e.highestTargetId);return e.highestTargetId=r.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Ln(t).next(e=>V.fromTimestamp(new Z(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Ln(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Ln(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.kn(t,i)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Ln(t).next(r=>(r.targetCount+=1,this.Qn(e,r),this.kn(t,r))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Tn(t).delete(e.targetId)).next(()=>this.Ln(t)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.kn(t,r)))}removeTargets(t,e,r){let i=0;const s=[];return Tn(t).Y((o,a)=>{const u=wr(a);u.sequenceNumber<=e&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(t,u)))}).next(()=>f.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Tn(t).Y((r,i)=>{const s=wr(i);e(s)})}Ln(t){return Rh(t).get("targetGlobalKey").next(e=>(P(null!==e),e))}kn(t,e){return Rh(t).put("targetGlobalKey",e)}qn(t,e){return Tn(t).put(uh(this.serializer,e))}Qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Ln(t).next(e=>e.targetCount)}getTargetData(t,e){const r=xe(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Tn(t).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=wr(a);dr(e,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(t,e,r){const i=[],s=me(t);return e.forEach(o=>{const a=Tt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(t,r,o))}),f.waitFor(i)}removeMatchingKeys(t,e,r){const i=me(t);return f.forEach(e,s=>{const o=Tt(s.path);return f.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){const r=me(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){const r=IDBKeyRange.bound([e],[e+1],!1,!0),i=me(t);let s=N();return i.Y({range:r,J:!0},(o,a,u)=>{const c=Bt(o[1]),l=new A(c);s=s.add(l)}).next(()=>s)}containsKey(t,e){const r=Tt(e.path),i=IDBKeyRange.bound([r],[Mc(r)],!1,!0);let s=0;return me(t).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}_t(t,e){return Tn(t).get(e).next(r=>r?wr(r):null)}}function Tn(n){return ht(n,"targets")}function Rh(n){return ht(n,"targetGlobal")}function me(n){return ht(n,"targetDocuments")}function Ph([n,t],[e,r]){const i=C(n,e);return 0===i?C(t,r):i}class Og{constructor(t){this.Kn=t,this.buffer=new z(Ph),this.$n=0}Un(){return++this.$n}Wn(t){const e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();Ph(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Vh{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(t){var e=this;y("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(0,p.Z)(function*(){e.Gn=null;try{yield e.localStore.collectGarbage(e.garbageCollector)}catch(r){re(r)?y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield ne(r)}yield e.zn(3e5)}))}}class Lg{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(0===e)return f.resolve(Ct._e);const r=new Og(e);return this.jn.forEachTarget(t,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(t,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.jn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(Eh)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Eh):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(t,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),tn()<=Ft.in.DEBUG&&y("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}class qg{constructor(t,e){this.db=t,this.garbageCollector=function Sh(n,t){return new Lg(n,t)}(this,e)}Hn(t){const e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}Zn(t){let e=0;return this.Jn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(r,i)=>e(i))}addReference(t,e,r){return Li(t,r)}removeReference(t,e,r){return Li(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Li(t,e)}er(t,e){return function(i,s){let o=!1;return wh(i).Z(a=>Ah(i,a,s).next(u=>(u&&(o=!0),f.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(t,(o,a)=>{if(a<=e){const u=this.er(t,o).next(c=>{if(!c)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,V.min()),me(t).delete([0,Tt(o.path)])))});i.push(u)}}).next(()=>f.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Li(t,e)}Xn(t,e){const r=me(t);let i,s=Ct._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==Ct._e&&e(new A(Bt(i)),s),s=c,i=u):s=Ct._e}).next(()=>{s!==Ct._e&&e(new A(Bt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Li(n,t){return me(n).put((i=n.currentSequenceNumber,{targetId:0,path:Tt(t.path),sequenceNumber:i}));var i}class xh{constructor(){this.changes=new Ht(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,H.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return void 0!==r?f.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Bg{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return Le(t).put(r)}removeEntry(t,e,r){return Le(t).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Di(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.tr(t,r)))}getEntry(t,e){let r=H.newInvalidDocument(e);return Le(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Sr(e))},(i,s)=>{r=this.nr(e,s)}).next(()=>r)}rr(t,e){let r={size:0,document:H.newInvalidDocument(e)};return Le(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Sr(e))},(i,s)=>{r={document:this.nr(e,s),size:Fi(s)}}).next(()=>r)}getEntries(t,e){let r=Vt();return this.ir(t,e,(i,s)=>{const o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(t,e){let r=Vt(),i=new j(A.comparator);return this.ir(t,e,(s,o)=>{const a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,Fi(o))}).next(()=>({documents:r,_r:i}))}ir(t,e,r){if(e.isEmpty())return f.resolve();let i=new z(Nh);e.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Sr(i.first()),Sr(i.last())),o=i.getIterator();let a=o.getNext();return Le(t).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{const h=A.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Nh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(Sr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){const o=e.path,a=[o.popLast().toArray(),o.lastSegment(),Di(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Le(t).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Vt();for(const h of c){const d=this.nr(A.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(mr(e,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,i){let s=Vt();const o=Dh(e,r),a=Dh(e,xt.max());return Le(t).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.nr(A.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(t){return new Ug(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return bh(t).get("remoteDocumentGlobalKey").next(e=>(P(!!e),e))}tr(t,e){return bh(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){const r=function Vg(n,t){let e;if(t.document)e=th(n.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const r=A.fromSegments(t.noDocument.path),i=Ne(t.noDocument.readTime);e=H.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return R();{const r=A.fromSegments(t.unknownDocument.path),i=Ne(t.unknownDocument.version);e=H.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){const s=new Z(i[0],i[1]);return V.fromTimestamp(s)}(t.readTime)),e}(this.serializer,e);if(!r.isNoDocument()||!r.version.isEqual(V.min()))return r}return H.newInvalidDocument(t)}}function Ch(n){return new Bg(n)}class Ug extends xh{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new Ht(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){const e=[];let r=0,i=new z((s,o)=>C(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ur.get(s);if(e.push(this.ar.removeEntry(t,s,a.readTime)),o.isValidDocument()){const u=ah(this.ar.serializer,o);i=i.add(s.path.popLast());const c=Fi(u);r+=c-a.size,e.push(this.ar.addEntry(t,s,u))}else if(r-=a.size,this.trackRemovals){const u=ah(this.ar.serializer,o.convertToNoDocument(V.min()));e.push(this.ar.addEntry(t,s,u))}}),i.forEach(s=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.ar.updateMetadata(t,r)),f.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(r=>(this.ur.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function bh(n){return ht(n,"remoteDocumentGlobal")}function Le(n){return ht(n,"remoteDocumentsV14")}function Sr(n){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Dh(n,t){const e=t.documentKey.path.toArray();return[n,Di(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Nh(n,t){const e=n.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=C(e[s],r[s]),i)return i;return i=C(e.length,r.length),i||(i=C(e[e.length-2],r[r.length-2]),i||C(e[e.length-1],r[r.length-1]))}class Gg{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class kh{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(null!==r&&yr(r.mutation,i,Pt.empty(),Z.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,N()).next(()=>r))}getLocalViewOfDocuments(t,e,r=N()){const i=Gt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=gr();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){const r=Gt();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,N()))}populateOverlays(t,e,r){const i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,i){let s=Vt();const o=pr(),a=pr();return e.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof Zt)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),yr(l.mutation,c,l.mutation.getFieldMask(),Z.now())):o.set(c.key,Pt.empty())}),this.recalculateAndSaveOverlays(t,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new Gg(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(t,e){const r=pr();let i=new j((o,a)=>o-a),s=N();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=e.get(u);if(null===c)return;let l=r.get(u)||Pt.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||N()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=wl();l.forEach(d=>{if(!s.has(d)){const m=Nl(e.get(d),r.get(d));null!==m&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return A.isDocumentKey((o=e).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(t,e.path):lo(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i);var o}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):f.resolve(Gt());let a=-1,u=s;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?f.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,s)).next(()=>this.computeViews(t,u,c,N())).next(l=>({batchId:a,changes:Al(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new A(e)).next(r=>{let i=gr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){const s=e.collectionGroup;let o=gr();return this.indexManager.getCollectionParents(t,s).next(a=>f.forEach(a,u=>{const c=(h=e,d=u.child(s),new Wt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.getDocumentsMatchingCollectionQuery(t,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,H.newInvalidDocument(l)))});let a=gr();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&yr(l.mutation,c,Pt.empty(),Z.now()),mr(e,c)&&(a=a.insert(u,c))}),a})}}class zg{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return f.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,{id:(i=e).id,version:i.version,createTime:rt(i.createTime)}),f.resolve();var i}getNamedQuery(t,e){return f.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,{name:(i=e).name,query:Ro(i.bundledQuery),readTime:rt(i.readTime)}),f.resolve();var i}}class Kg{constructor(){this.overlays=new j(A.comparator),this.hr=new Map}getOverlay(t,e){return f.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Gt();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.ht(t,e,s)}),f.resolve()}removeOverlaysForBatchId(t,e,r){const i=this.hr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),f.resolve()}getOverlaysForCollection(t,e,r){const i=Gt(),s=e.length+1,o=new A(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return f.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new j((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=Gt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Gt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return f.resolve(a)}ht(t,e,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new _o(e,r));let s=this.hr.get(e);void 0===s&&(s=N(),this.hr.set(e,s)),this.hr.set(e,s.add(r.key))}}class Do{constructor(){this.Pr=new z(dt.Ir),this.Tr=new z(dt.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const r=new dt(t,e);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Ar(new dt(t,e))}Rr(t,e){t.forEach(r=>this.removeReference(r,e))}Vr(t){const e=new A(new F([])),r=new dt(e,t),i=new dt(e,t+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new A(new F([])),r=new dt(e,t),i=new dt(e,t+1);let s=N();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){const e=new dt(t,0),r=this.Pr.firstAfterOrEqual(e);return null!==r&&t.isEqual(r.key)}}class dt{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return A.comparator(t.key,e.key)||C(t.pr,e.pr)}static Er(t,e){return C(t.pr,e.pr)||A.comparator(t.key,e.key)}}class jg{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new z(dt.Ir)}checkEmpty(t){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,r,i){const s=this.yr;this.yr++;const o=new go(s,e,r,i);this.mutationQueue.push(o);for(const a of i)this.wr=this.wr.add(new dt(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(t,e){return f.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const i=this.br(e+1),s=i<0?0:i;return f.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new dt(e,0),i=new dt(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{const a=this.Sr(o.pr);s.push(a)}),f.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new z(C);return e.forEach(i=>{const s=new dt(i,0),o=new dt(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),f.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,i=r.length+1;let s=r;A.isDocumentKey(s)||(s=s.child(""));const o=new dt(new A(s),0);let a=new z(C);return this.wr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),f.resolve(this.Dr(a))}Dr(t){const e=[];return t.forEach(r=>{const i=this.Sr(r);null!==i&&e.push(i)}),e}removeMutationBatch(t,e){P(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let r=this.wr;return f.forEach(e.mutations,i=>{const s=new dt(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,e){const r=new dt(e,0),i=this.wr.firstAfterOrEqual(r);return f.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return f.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Qg{constructor(t){this.vr=t,this.docs=new j(A.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return f.resolve(r?r.document.mutableCopy():H.newInvalidDocument(e))}getEntries(t,e){let r=Vt();return e.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():H.newInvalidDocument(i))}),f.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Vt();const o=e.path,a=new A(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||to(Oc(l),r)<=0||(i.has(l.key)||mr(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(t,e,r,i){R()}Fr(t,e){return f.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new $g(this)}getSize(t){return f.resolve(this.size)}}class $g extends xh{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this.ar.addEntry(t,i)):this.ar.removeEntry(r)}),f.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Wg{constructor(t){this.persistence=t,this.Mr=new Ht(e=>xe(e),dr),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Do,this.targetCount=0,this.Br=Oe.Nn()}forEachTarget(t,e){return this.Mr.forEach((r,i)=>e(i)),f.resolve()}getLastRemoteSnapshotVersion(t){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return f.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Or&&(this.Or=e),f.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new Oe(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,f.resolve()}updateTargetData(t,e){return this.qn(e),f.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,f.resolve()}removeTargets(t,e,r){let i=0;const s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=e&&null===r.get(a.targetId)&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),f.waitFor(s).next(()=>i)}getTargetCount(t){return f.resolve(this.targetCount)}getTargetData(t,e){const r=this.Mr.get(e)||null;return f.resolve(r)}addMatchingKeys(t,e,r){return this.Nr.dr(e,r),f.resolve()}removeMatchingKeys(t,e,r){this.Nr.Rr(e,r);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),f.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),f.resolve()}getMatchingKeysForTargetId(t,e){const r=this.Nr.gr(e);return f.resolve(r)}containsKey(t,e){return f.resolve(this.Nr.containsKey(e))}}class No{constructor(t,e){this.Lr={},this.overlays={},this.kr=new Ct(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Wg(this),this.indexManager=new kg,this.remoteDocumentCache=new Qg(r=>this.referenceDelegate.Kr(r)),this.serializer=new oh(e),this.$r=new zg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Kg,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Lr[t.toKey()];return r||(r=new jg(e,this.referenceDelegate),this.Lr[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,r){y("MemoryPersistence","Starting transaction:",t);const i=new Hg(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,e){return f.or(Object.values(this.Lr).map(r=>()=>r.containsKey(t,e)))}}class Hg extends qc{constructor(t){super(),this.currentSequenceNumber=t}}class qi{constructor(t){this.persistence=t,this.zr=new Do,this.jr=null}static Hr(t){return new qi(t)}get Jr(){if(this.jr)return this.jr;throw R()}addReference(t,e,r){return this.zr.addReference(r,e),this.Jr.delete(r.toString()),f.resolve()}removeReference(t,e,r){return this.zr.removeReference(r,e),this.Jr.add(r.toString()),f.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),f.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(i=>this.Jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Jr,r=>{const i=A.fromPath(r);return this.Yr(t,i).next(s=>{s||e.removeEntry(i,V.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(r=>{r?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return f.or([()=>f.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Zg{constructor(t){this.serializer=t}N(t,e,r,i){const s=new pi("createOrUpgrade",e);var u;r<1&&i>=1&&(t.createObjectStore("owner"),(u=t).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zc,{unique:!0}),u.createObjectStore("documentMutations"),Mh(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=f.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),Mh(t)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:V.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zc,{unique:!0});const h=c.store("mutations"),d=l.map(m=>h.put(m));return f.waitFor(d)})}(t,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(t,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(t)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:Mm});c.createIndex("collectionPathOverlayIndex",Fm,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Om,{unique:!1})}(t)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:wm});c.createIndex("documentKeyIndex",Rm),c.createIndex("collectionGroupIndex",Pm)}(t)).next(()=>this.ii(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(t,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:bm}).createIndex("sequenceNumberIndex",Dm,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Nm}).createIndex("documentKeyIndex",km,{unique:!1})}(t))),o}ei(t){let e=0;return t.store("remoteDocuments").Y((r,i)=>{e+=Fi(i)}).next(()=>{const r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(t){const e=t.store("mutationQueues"),r=t.store("mutations");return e.W().next(i=>f.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{P(u.userId===s.userId);const c=ke(this.serializer,u);return vh(t,s.userId,c).next(()=>{})}))}))}ti(t){const e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,a)=>{const u=new F(o),c=[0,Tt(u)];s.push(e.get(c).next(l=>l?f.resolve():e.put({targetId:0,path:Tt(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>f.waitFor(s))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:Cm});const r=e.store("collectionParents"),i=new bo,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Tt(u)})}};return e.store("remoteDocuments").Y({J:!0},(o,a)=>{const u=new F(o);return s(u.popLast())}).next(()=>e.store("documentMutations").Y({J:!0},([o,a,u],c)=>{const l=Bt(a);return s(l.popLast())}))}ri(t){const e=t.store("targets");return e.Y((r,i)=>{const s=wr(i),o=uh(this.serializer,s);return e.put(o)})}ii(t,e){const r=e.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const a=e.store("remoteDocumentsV14"),u=(h=o,h.document?new A(F.fromString(h.document.name).popFirst(5)):h.noDocument?A.fromSegments(h.noDocument.path):h.unknownDocument?A.fromSegments(h.unknownDocument.path):R()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var h;i.push(a.put(c))}).next(()=>f.waitFor(i))}si(t,e){const r=e.store("mutations"),i=Ch(this.serializer),s=new No(qi.Hr,this.serializer.ct);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:N();ke(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new lt(c),h=Ni.lt(this.serializer,l),d=s.getIndexManager(l),m=Oi.lt(l,this.serializer,d,s.referenceDelegate);return new kh(i,m,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ro(e,Ct._e),u).next()})})}}function Mh(n){n.createObjectStore("targetDocuments",{keyPath:Sm}).createIndex("documentTargetsIndex",xm,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Vm,{unique:!0}),n.createObjectStore("targetGlobal")}const ko="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Mo{constructor(t,e,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!Mo.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qg(this,i),this.Ti=e+"main",this.serializer=new oh(u),this.Ei=new Dt(this.Ti,this.ui,new Zg(this.serializer)),this.Qr=new Fg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ch(this.serializer),this.$r=new Sg,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===l&&nt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,ko);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Ct(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){var e=this;return this.Ii=function(){var r=(0,p.Z)(function*(i){if(e.started)return t(i)});return function(i){return r.apply(this,arguments)}}(),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.L(function(){var e=(0,p.Z)(function*(r){null===r.newVersion&&(yield t())});return function(r){return e.apply(this,arguments)}}())}setNetworkEnabled(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget((0,p.Z)(function*(){e.started&&(yield e.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ui(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(re(t))return y("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return xr(t).get("owner").next(e=>f.resolve(this.Si(e)))}bi(t){return Ui(t).delete(this.clientId)}Di(){var t=this;return(0,p.Z)(function*(){if(t.isPrimary&&!t.Ci(t.Pi,18e5)){t.Pi=Date.now();const e=yield t.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=ht(r,"clientMetadata");return i.W().next(s=>{const o=t.vi(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(t.di)for(const r of e)t.di.removeItem(t.Fi(r.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?f.resolve(!0):xr(t).get("owner").next(e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,ko);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ui(t).W().next(r=>void 0===this.vi(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(e=>(this.isPrimary!==e&&y("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){var t=this;return(0,p.Z)(function*(){t.qr=!1,t.xi(),t.hi&&(t.hi.cancel(),t.hi=null),t.Oi(),t.Ni(),yield t.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const r=new ro(e,Ct._e);return t.yi(r).next(()=>t.bi(r))}),t.Ei.close(),t.Bi()})()}vi(t,e){return t.filter(r=>this.Ci(r.updateTimeMs,e)&&!this.Mi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",t=>Ui(t).W().next(e=>this.vi(e,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return Oi.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Mg(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Ni.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,r){y("IndexedDbPersistence","Starting transaction:",t);const i="readonly"===e?"readonly":"readwrite",s=15===(u=this.ui)?qm:14===u?$c:13===u?Qc:12===u?Lm:11===u?jc:void R();var u;let o;return this.Ei.runTransaction(t,i,s,a=>(o=new ro(a,this.kr?this.kr.next():Ct._e),"readwrite-primary"===e?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw nt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new _(g.FAILED_PRECONDITION,Lc);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(t){return xr(t).get("owner").next(e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,ko)})}wi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xr(t).put("owner",e)}static D(){return Dt.D()}yi(t){const e=xr(t);return e.get("owner").next(r=>this.Si(r)?(y("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):f.resolve())}Ci(t,e){const r=Date.now();return!(t<r-e||t>r&&(nt(`Detected an update time that is in the future: ${t} > ${r}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;(0,q.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{const r=null!==(null===(e=this.di)||void 0===e?void 0:e.getItem(this.Fi(t)));return y("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return nt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){nt("Failed to set zombie client id.",t)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function xr(n){return ht(n,"owner")}function Ui(n){return ht(n,"clientMetadata")}function Fo(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}class Oo{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.qi=r,this.Qi=i}static Ki(t,e){let r=N(),i=N();for(const s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Oo(t,e.fromCache,r,i)}}class Yg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Fh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,q.G6)()?8:Dt.v((0,q.z$)())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,r,i){const s={result:null};return this.ji(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Yg;return this.Ji(t,e,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,e,o,a.size)})}).next(()=>s.result)}Yi(t,e,r,i){return r.documentReadCount<this.Wi?(tn()<=Ft.in.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",ln(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),f.resolve()):(tn()<=Ft.in.DEBUG&&y("QueryEngine","Query:",ln(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(tn()<=Ft.in.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",ln(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,wt(e))):f.resolve())}ji(t,e){if(_l(e))return f.resolve(null);let r=wt(e);return this.indexManager.getIndexType(t,r).next(i=>0===i?null:(null!==e.limit&&1===i&&(e=Pi(e,null,"F"),r=wt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{const o=N(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{const c=this.Zi(e,a);return this.Xi(e,c,o,u.readTime)?this.ji(t,Pi(e,null,"F")):this.es(t,c,e,u)}))})))}Hi(t,e,r,i){return _l(e)||i.isEqual(V.min())?f.resolve(null):this.zi.getDocuments(t,r).next(s=>{const o=this.Zi(e,s);return this.Xi(e,o,r,i)?f.resolve(null):(tn()<=Ft.in.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ln(e)),this.es(t,o,e,Fc(i,-1)).next(a=>a))})}Zi(t,e){let r=new z(El(t));return e.forEach((i,s)=>{mr(t,s)&&(r=r.add(s))}),r}Xi(t,e,r,i){if(null===t.limit)return!1;if(r.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,e,r){return tn()<=Ft.in.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",ln(e)),this.zi.getDocumentsMatchingQuery(t,e,xt.min(),r)}es(t,e,r,i){return this.zi.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Xg{constructor(t,e,r,i){this.persistence=t,this.ts=e,this.serializer=i,this.ns=new j(C),this.rs=new Ht(s=>xe(s),dr),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new kh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}}function Oh(n,t,e,r){return new Xg(n,t,e,r)}function Lh(n,t){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,p.Z)(function*(n,t){const e=E(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e._s(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=N();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})}),Lo.apply(this,arguments)}function qh(n){const t=E(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Bh(n,t,e){let r=N(),i=N();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Vt();return e.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(V.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function ep(n,t){const e=E(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function En(n,t){const e=E(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.Qr.getTargetData(r,t).next(s=>s?(i=s,f.resolve(i)):e.Qr.allocateTargetId(r).next(o=>(i=new Yt(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=e.ns.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ns=e.ns.insert(r.targetId,r),e.rs.set(t,r.targetId)),r})}function vn(n,t,e){return qo.apply(this,arguments)}function qo(){return qo=(0,p.Z)(function*(n,t,e){const r=E(n),i=r.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!re(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}),qo.apply(this,arguments)}function Gi(n,t,e){const r=E(n);let i=V.min(),s=N();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const h=E(u),d=h.rs.get(l);return void 0!==d?f.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,wt(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,t,e?i:V.min(),e?s:N())).next(a=>(zh(r,Tl(t),a),{documents:a,hs:s})))}function Uh(n,t){const e=E(n),r=E(e.Qr),i=e.ns.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r._t(s,t).next(o=>o?o.target:null))}function Gh(n,t){const e=E(n),r=e.ss.get(t)||V.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.os.getAllFromCollectionGroup(i,t,Fc(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(zh(e,t,i),i))}function zh(n,t,e){let r=n.ss.get(t)||V.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(t,r)}function Bo(){return Bo=(0,p.Z)(function*(n,t,e,r){const i=E(n);let s=N(),o=Vt();for(const c of e){const l=t.Ps(c.metadata.name);c.document&&(s=s.add(l));const h=t.Is(c);h.setReadTime(t.Ts(c.metadata.readTime)),o=o.insert(l,h)}const a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield En(i,(l=r,wt(un(F.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Bh(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))}),Bo.apply(this,arguments)}function rp(n,t){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,p.Z)(function*(n,t,e=N()){const r=yield En(n,wt(Ro(t.bundledQuery))),i=E(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=rt(t.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.$r.saveNamedQuery(s,t);const a=r.withResumeToken(ot.EMPTY_BYTE_STRING,o);return i.ns=i.ns.insert(a.targetId,a),i.Qr.updateTargetData(s,a).next(()=>i.Qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Qr.addMatchingKeys(s,e,r.targetId)).next(()=>i.$r.saveNamedQuery(s,t))})}),Uo.apply(this,arguments)}function Kh(n,t){return`firestore_clients_${n}_${t}`}function jh(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Go(n,t){return`firestore_targets_${n}_${t}`}class zi{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Es(t,e,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new _(i.error.code,i.error.message))),o?new zi(t,e,i.state,s):(nt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}ds(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Cr{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Es(t,e){const r=JSON.parse(e);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new _(r.error.code,r.error.message))),s?new Cr(t,r.state,i):(nt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Ki{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){const r=JSON.parse(e);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=fo();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Uc(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Ki(t,s):(nt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class zo{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new zo(e.clientId,e.onlineState):(nt("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Ko{constructor(){this.activeTargetIds=fo()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class jo{constructor(t,e,r,i,s){this.window=t,this.oi=e,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new j(C),this.started=!1,this.ys=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=Kh(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Ko),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){var t=this;return(0,p.Z)(function*(){const e=yield t.syncEngine.Li();for(const i of e){if(i===t.Vs)continue;const s=t.getItem(Kh(t.persistenceKey,i));if(s){const o=Ki.Es(i,s);o&&(t.ps=t.ps.insert(o.clientId,o))}}t.Ms();const r=t.storage.getItem(t.vs);if(r){const i=t.xs(r);i&&t.Os(i)}for(const i of t.ys)t.gs(i);t.ys=[],t.window.addEventListener("pagehide",()=>t.shutdown()),t.started=!0})()}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Bs(t,"pending")}updateMutationState(t,e,r){this.Bs(t,e,r),this.Ls(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const r=this.storage.getItem(Go(this.persistenceKey,t));if(r){const i=Cr.Es(t,r);i&&(e=i.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Go(this.persistenceKey,t))}updateQueryState(t,e,r){this.qs(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Ls(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e}setItem(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){var e=this;const r=t;if(r.storageArea===this.storage){if(y("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ws)return void nt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,p.Z)(function*(){if(e.started){if(null!==r.key)if(e.bs.test(r.key)){if(null==r.newValue){const i=e.$s(r.key);return e.Us(i,null)}{const i=e.Ws(r.key,r.newValue);if(i)return e.Us(i.clientId,i)}}else if(e.Ds.test(r.key)){if(null!==r.newValue){const i=e.Gs(r.key,r.newValue);if(i)return e.zs(i)}}else if(e.Cs.test(r.key)){if(null!==r.newValue){const i=e.js(r.key,r.newValue);if(i)return e.Hs(i)}}else if(r.key===e.vs){if(null!==r.newValue){const i=e.xs(r.newValue);if(i)return e.Os(i)}}else if(r.key===e.Ss){const i=function(o){let a=Ct._e;if(null!=o)try{const u=JSON.parse(o);P("number"==typeof u),a=u}catch(u){nt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==Ct._e&&e.sequenceNumberHandler(i)}else if(r.key===e.Fs){const i=e.Js(r.newValue);yield Promise.all(i.map(s=>e.syncEngine.Ys(s)))}}else e.ys.push(r)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(t,e,r){const i=new zi(this.currentUser,t,e,r),s=jh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.ds())}Ls(t){const e=jh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:t}))}qs(t,e,r){const i=Go(this.persistenceKey,t),s=new Cr(t,e,r);this.setItem(i,s.ds())}Ks(t){const e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){const e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){const r=this.$s(t);return Ki.Es(r,e)}Gs(t,e){const r=this.Ds.exec(t),i=Number(r[1]);return zi.Es(new lt(void 0!==r[2]?r[2]:null),i,e)}js(t,e){const r=this.Cs.exec(t),i=Number(r[1]);return Cr.Es(i,e)}xs(t){return zo.Es(t)}Js(t){return JSON.parse(t)}zs(t){var e=this;return(0,p.Z)(function*(){if(t.user.uid===e.currentUser.uid)return e.syncEngine.Zs(t.batchId,t.state,t.error);y("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})()}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){const r=e?this.ps.insert(t,e):this.ps.remove(t),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=fo();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}}class Qh{constructor(){this.no=new Ko,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,r){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Ko,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ip{io(t){}shutdown(){}}class $h{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ji=null;function Qo(){return null===ji?ji=268435456+Math.round(2147483648*Math.random()):ji++,"0x"+ji.toString(16)}const sp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class op{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const vt="WebChannelConnection";class ap extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+e.host,this.po=`projects/${i}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(e,r,i,s,o){const a=Qo(),u=this.bo(e,r.toUriEncodedString());y("RestConnection",`Sending RPC '${e}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(e,u,c,i).then(l=>(y("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw Rt("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(e,r,i,s,o,a){return this.So(e,r,i,s,o)}Do(e,r,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Je,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}bo(e,r){return`${this.fo}/v1/${r}:${sp[e]}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,r,i){const s=Qo();return new Promise((o,a)=>{const u=new im;u.setWithCredentials(!0),u.listenOnce(nm.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ys.NO_ERROR:const l=u.getResponseJson();y(vt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Ys.TIMEOUT:y(vt,`RPC '${t}' ${s} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case Ys.HTTP_ERROR:const h=u.getStatus();if(y(vt,`RPC '${t}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const m=d?.error;if(m&&m.status&&m.message){const I=function(T){const S=T.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(S)>=0?S:g.UNKNOWN}(m.status);a(new _(I,m.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{y(vt,`RPC '${t}' ${s} completed.`)}});const c=JSON.stringify(i);y(vt,`RPC '${t}' ${s} sending request:`,i),u.send(e,"POST",c,r,15)})}Fo(t,e,r){const i=Qo(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=tm(),a=em(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;const l=s.join("");y(vt,`Creating RPC '${t}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let d=!1,m=!1;const I=new op({lo:T=>{m?y(vt,`Not sending because RPC '${t}' stream ${i} is closed:`,T):(d||(y(vt,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),y(vt,`RPC '${t}' stream ${i} sending:`,T),h.send(T))},ho:()=>h.close()}),v=(T,S,D)=>{T.listen(S,x=>{try{D(x)}catch(k){setTimeout(()=>{throw k},0)}})};return v(h,gi.EventType.OPEN,()=>{m||y(vt,`RPC '${t}' stream ${i} transport opened.`)}),v(h,gi.EventType.CLOSE,()=>{m||(m=!0,y(vt,`RPC '${t}' stream ${i} transport closed`),I.Vo())}),v(h,gi.EventType.ERROR,T=>{m||(m=!0,Rt(vt,`RPC '${t}' stream ${i} transport errored:`,T),I.Vo(new _(g.UNAVAILABLE,"The operation could not be completed")))}),v(h,gi.EventType.MESSAGE,T=>{var S;if(!m){const D=T.data[0];P(!!D);const k=D.error||(null===(S=D[0])||void 0===S?void 0:S.error);if(k){y(vt,`RPC '${t}' stream ${i} received error:`,k);const K=k.status;let G=function(Iy){const Zd=it[Iy];if(void 0!==Zd)return ql(Zd)}(K),at=k.message;void 0===G&&(G=g.INTERNAL,at="Unknown error status: "+K+" with message "+k.message),m=!0,I.Vo(new _(G,at)),h.close()}else y(vt,`RPC '${t}' stream ${i} received:`,D),I.mo(D)}}),v(a,rm.STAT_EVENT,T=>{T.stat===Cc.PROXY?y(vt,`RPC '${t}' stream ${i} detected buffering proxy`):T.stat===Cc.NOPROXY&&y(vt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.Ro()},0),I}}function Wh(){return typeof window<"u"?window:null}function Qi(){return typeof document<"u"?document:null}function br(n){return new _g(n,!0)}class $o{constructor(t,e,r=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,e-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Hh{constructor(t,e,r,i,s,o,a,u){this.oi=t,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new $o(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var t=this;return(0,p.Z)(function*(){t.Ho()&&(yield t.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){var t=this;return(0,p.Z)(function*(){if(t.Jo())return t.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,e){var r=this;return(0,p.Z)(function*(){r.n_(),r.r_(),r.jo.cancel(),r.Wo++,4!==t?r.jo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(nt(e.toString()),nt("Using maximum backoff delay to prevent overloading the backend."),r.jo.ko()):e&&e.code===g.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.i_(),r.stream.close(),r.stream=null),r.state=t,yield r.listener.To(e)})()}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===e&&this.o_(r,i)},r=>{t(()=>{const i=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(t,e){const r=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){var t=this;this.state=5,this.jo.qo((0,p.Z)(function*(){t.state=0,t.start()}))}__(t){return y("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget(()=>this.Wo===t?e():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class up extends Hh{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function Tg(n,t){let e;if("targetChange"in t){const r="NO_CHANGE"===(c=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:R(),i=t.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(void 0===l||"string"==typeof l),ot.fromBase64String(l||"")):(P(void 0===l||l instanceof Uint8Array),ot.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){const l=void 0===c.code?g.UNKNOWN:ql(c.code);return new _(l,c.message||"")}(o);e=new Kl(r,i,s,a||null)}else if("documentChange"in t){const r=t.documentChange,i=zt(n,r.document.name),s=rt(r.document.updateTime),o=r.document.createTime?rt(r.document.createTime):V.min(),a=new pt({mapValue:{fields:r.document.fields}}),u=H.newFoundDocument(i,s,o,a);e=new bi(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in t){const r=t.documentDelete,i=zt(n,r.document),s=r.readTime?rt(r.readTime):V.min(),o=H.newNoDocument(i,s);e=new bi([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=zt(n,r.document);e=new bi([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return R();{const r=t.filter,{count:i=0,unchangedNames:s}=r,o=new hg(i,s);e=new zl(r.targetId,o)}}var c;return e}(this.serializer,t),r=function(s){if(!("targetChange"in s))return V.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?V.min():o.readTime?rt(o.readTime):V.min()}(t);return this.listener.u_(e,r)}c_(t){const e={};e.database=vo(this.serializer),e.addTarget=function(s,o){let a;const u=o.target;if(a=wi(u)?{documents:eh(s,u)}:{query:wo(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Wl(s,o.resumeToken);const c=Io(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(V.min())>0){a.readTime=gn(s,o.snapshotVersion.toTimestamp());const c=Io(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,t);const r=function vg(n,t){const e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R()}}(t.purpose);return null==e?null:{"goog-listen-tags":e}}(0,t);r&&(e.labels=r),this.t_(e)}l_(t){const e={};e.database=vo(this.serializer),e.removeTarget=t,this.t_(e)}}class cp extends Hh{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(P(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function Eg(n,t){return n&&n.length>0?(P(void 0!==t),n.map(e=>function(i,s){let o=rt(i.updateTime?i.updateTime:s);return o.isEqual(V.min())&&(o=rt(s)),new ag(o,i.transformResults||[])}(e,t))):[]}(t.writeResults,t.commitTime),r=rt(t.commitTime);return this.listener.T_(r,e)}return P(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=vo(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map(r=>Ar(this.serializer,r))};this.t_(e)}}class lp extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,Eo(e,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(g.UNKNOWN,s.toString())})}vo(t,e,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,Eo(e,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class dp{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(nt(e),this.g_=!1):y("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class fp{constructor(t,e,r,i,s){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;ge(o)&&(y("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(l){const h=E(l);h.v_.add(4),yield An(h),h.x_.set("Unknown"),h.v_.delete(4),yield Dr(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.x_=new dp(r,i)}}function Dr(n){return Ho.apply(this,arguments)}function Ho(){return Ho=(0,p.Z)(function*(n){if(ge(n))for(const t of n.F_)yield t(!0)}),Ho.apply(this,arguments)}function An(n){return Zo.apply(this,arguments)}function Zo(){return Zo=(0,p.Z)(function*(n){for(const t of n.F_)yield t(!1)}),Zo.apply(this,arguments)}function $i(n,t){const e=E(n);e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),Jo(e)?Xo(e):Rn(e).Jo()&&Yo(e,t))}function Nr(n,t){const e=E(n),r=Rn(e);e.C_.delete(t),r.Jo()&&Zh(e,t),0===e.C_.size&&(r.Jo()?r.Xo():ge(e)&&e.x_.set("Unknown"))}function Yo(n,t){if(n.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(V.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Rn(n).c_(t)}function Zh(n,t){n.O_.Oe(t),Rn(n).l_(t)}function Xo(n){n.O_=new fg({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.C_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),Rn(n).start(),n.x_.p_()}function Jo(n){return ge(n)&&!Rn(n).Ho()&&n.C_.size>0}function ge(n){return 0===E(n).v_.size}function Yh(n){n.O_=void 0}function mp(n){return ta.apply(this,arguments)}function ta(){return ta=(0,p.Z)(function*(n){n.C_.forEach((t,e)=>{Yo(n,t)})}),ta.apply(this,arguments)}function gp(n,t){return ea.apply(this,arguments)}function ea(){return ea=(0,p.Z)(function*(n,t){Yh(n),Jo(n)?(n.x_.S_(t),Xo(n)):n.x_.set("Unknown")}),ea.apply(this,arguments)}function pp(n,t,e){return na.apply(this,arguments)}function na(){return na=(0,p.Z)(function*(n,t,e){if(n.x_.set("Online"),t instanceof Kl&&2===t.state&&t.cause)try{yield(r=(0,p.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.C_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.C_.delete(u),s.O_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,t)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Wi(n,r)}else if(t instanceof bi?n.O_.$e(t):t instanceof zl?n.O_.Je(t):n.O_.Ge(t),!e.isEqual(V.min()))try{const r=yield qh(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){const a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(ot.EMPTY_BYTE_STRING,l.snapshotVersion)),Zh(s,u);const h=new Yt(l.target,u,c,l.sequenceNumber);Yo(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Wi(n,r)}var r}),na.apply(this,arguments)}function Wi(n,t,e){return ra.apply(this,arguments)}function ra(){return ra=(0,p.Z)(function*(n,t,e){if(!re(t))throw t;n.v_.add(1),yield An(n),n.x_.set("Offline"),e||(e=()=>qh(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){y("RemoteStore","Retrying IndexedDB access"),yield e(),n.v_.delete(1),yield Dr(n)}))}),ra.apply(this,arguments)}function Xh(n,t){return t().catch(e=>Wi(n,e,t))}function wn(n){return ia.apply(this,arguments)}function ia(){return ia=(0,p.Z)(function*(n){const t=E(n),e=pe(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;_p(t);)try{const i=yield ep(t.localStore,r);if(null===i){0===t.D_.length&&e.Xo();break}r=i.batchId,yp(t,i)}catch(i){yield Wi(t,i)}Jh(t)&&td(t)}),ia.apply(this,arguments)}function _p(n){return ge(n)&&n.D_.length<10}function yp(n,t){n.D_.push(t);const e=pe(n);e.Jo()&&e.P_&&e.I_(t.mutations)}function Jh(n){return ge(n)&&!pe(n).Ho()&&n.D_.length>0}function td(n){pe(n).start()}function Ip(n){return sa.apply(this,arguments)}function sa(){return sa=(0,p.Z)(function*(n){pe(n).d_()}),sa.apply(this,arguments)}function Tp(n){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(n){const t=pe(n);for(const e of n.D_)t.I_(e.mutations)}),oa.apply(this,arguments)}function Ep(n,t,e){return aa.apply(this,arguments)}function aa(){return aa=(0,p.Z)(function*(n,t,e){const r=n.D_.shift(),i=po.from(r,t,e);yield Xh(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield wn(n)}),aa.apply(this,arguments)}function vp(n,t){return ua.apply(this,arguments)}function ua(){return ua=(0,p.Z)(function*(n,t){var e;t&&pe(n).P_&&(yield(e=(0,p.Z)(function*(i,s){if(Ll(a=s.code)&&a!==g.ABORTED){const o=i.D_.shift();pe(i).Zo(),yield Xh(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield wn(i)}var a}),function r(i,s){return e.apply(this,arguments)})(n,t)),Jh(n)&&td(n)}),ua.apply(this,arguments)}function ed(n,t){return ca.apply(this,arguments)}function ca(){return ca=(0,p.Z)(function*(n,t){const e=E(n);e.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");const r=ge(e);e.v_.add(3),yield An(e),r&&e.x_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),yield Dr(e)}),ca.apply(this,arguments)}function la(n,t){return ha.apply(this,arguments)}function ha(){return ha=(0,p.Z)(function*(n,t){const e=E(n);t?(e.v_.delete(2),yield Dr(e)):t||(e.v_.add(2),yield An(e),e.x_.set("Unknown"))}),ha.apply(this,arguments)}function Rn(n){return n.N_||(n.N_=function(e,r,i){const s=E(e);return s.R_(),new up(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:mp.bind(null,n),To:gp.bind(null,n),u_:pp.bind(null,n)}),n.F_.push(function(){var t=(0,p.Z)(function*(e){e?(n.N_.Zo(),Jo(n)?Xo(n):n.x_.set("Unknown")):(yield n.N_.stop(),Yh(n))});return function(e){return t.apply(this,arguments)}}())),n.N_}function pe(n){return n.B_||(n.B_=function(e,r,i){const s=E(e);return s.R_(),new cp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:Ip.bind(null,n),To:vp.bind(null,n),E_:Tp.bind(null,n),T_:Ep.bind(null,n)}),n.F_.push(function(){var t=(0,p.Z)(function*(e){e?(n.B_.Zo(),yield wn(n)):(yield n.B_.stop(),n.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))});return function(e){return t.apply(this,arguments)}}())),n.B_}class da{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){const o=Date.now()+r,a=new da(t,e,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pn(n,t){if(nt("AsyncQueue",`${t}: ${n}`),re(n))return new _(g.UNAVAILABLE,`${t}: ${n}`);throw n}class Vn{constructor(t){this.comparator=t?(e,r)=>t(e,r)||A.comparator(e.key,r.key):(e,r)=>A.comparator(e.key,r.key),this.keyedMap=gr(),this.sortedSet=new j(this.comparator)}static emptySet(t){return new Vn(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Vn)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const r=new Vn;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class nd{constructor(){this.L_=new j(A.comparator)}track(t){const e=t.doc.key,r=this.L_.get(e);r?0!==t.type&&3===r.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==r.type?this.L_=this.L_.insert(e,{type:r.type,doc:t.doc}):2===t.type&&2===r.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===r.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===r.type?this.L_=this.L_.remove(e):1===t.type&&2===r.type?this.L_=this.L_.insert(e,{type:1,doc:r.doc}):0===t.type&&1===r.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):R():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal((e,r)=>{t.push(r)}),t}}class Sn{constructor(t,e,r,i,s,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,i,s){const o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new Sn(t,e,Vn.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&fr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}}class Ap{constructor(){this.q_=void 0,this.Q_=[]}}class wp{constructor(){this.queries=new Ht(t=>Il(t),fr),this.onlineState="Unknown",this.K_=new Set}}function fa(n,t){return ma.apply(this,arguments)}function ma(){return ma=(0,p.Z)(function*(n,t){const e=E(n),r=t.query;let i=!1,s=e.queries.get(r);if(s||(i=!0,s=new Ap),i)try{s.q_=yield e.onListen(r)}catch(o){const a=Pn(o,`Initialization of query '${ln(t.query)}' failed`);return void t.onError(a)}e.queries.set(r,s),s.Q_.push(t),t.U_(e.onlineState),s.q_&&t.W_(s.q_)&&_a(e)}),ma.apply(this,arguments)}function ga(n,t){return pa.apply(this,arguments)}function pa(){return pa=(0,p.Z)(function*(n,t){const e=E(n),r=t.query;let i=!1;const s=e.queries.get(r);if(s){const o=s.Q_.indexOf(t);o>=0&&(s.Q_.splice(o,1),i=0===s.Q_.length)}if(i)return e.queries.delete(r),e.onUnlisten(r)}),pa.apply(this,arguments)}function Rp(n,t){const e=E(n);let r=!1;for(const i of t){const o=e.queries.get(i.query);if(o){for(const a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&_a(e)}function Pp(n,t,e){const r=E(n),i=r.queries.get(t);if(i)for(const s of i.Q_)s.onError(e);r.queries.delete(t)}function _a(n){n.K_.forEach(t=>{t.next()})}class ya{constructor(t,e,r){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(t){if(!this.options.includeMetadataChanges){const r=[];for(const i of t.docChanges)3!==i.type&&r.push(i);t=new Sn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){return!t.fromCache||(!this.options.Z_||!("Offline"!==e))&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Y_(t){t=Sn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class Vp{constructor(t,e){this.X_=t,this.byteLength=e}ea(){return"metadata"in this.X_}}class rd{constructor(t){this.serializer=t}Ps(t){return zt(this.serializer,t)}Is(t){return t.metadata.exists?th(this.serializer,t.document,!1):H.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return rt(t)}}class Sp{constructor(t,e,r){this.ta=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=id(t)}na(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.X_.namedQuery)this.queries.push(t.X_.namedQuery);else if(t.X_.documentMetadata){this.documents.push({metadata:t.X_.documentMetadata}),t.X_.documentMetadata.exists||++e;const r=F.fromString(t.X_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.X_.document&&(this.documents[this.documents.length-1].document=t.X_.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ra(t){const e=new Map,r=new rd(this.serializer);for(const i of t)if(i.metadata.queries){const s=r.Ps(i.metadata.name);for(const o of i.metadata.queries){const a=(e.get(o)||N()).add(s);e.set(o,a)}}return e}complete(){var t=this;return(0,p.Z)(function*(){const e=yield function np(n,t,e,r){return Bo.apply(this,arguments)}(t.localStore,new rd(t.serializer),t.documents,t.ta.id),r=t.ra(t.documents);for(const i of t.queries)yield rp(t.localStore,i,r.get(i.name));return t.progress.taskState="Success",{progress:t.progress,ia:t.collectionGroups,sa:e}})()}}function id(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class sd{constructor(t){this.key=t}}class od{constructor(t){this.key=t}}class ad{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=N(),this.mutatedKeys=N(),this.ua=El(t),this.ca=new Vn(this.ua)}get la(){return this.oa}ha(t,e){const r=e?e.Pa:new nd,i=e?e.ca:this.ca;let s=e?e.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{const d=i.get(l),m=mr(this.query,h)?h:null,I=!!d&&this.mutatedKeys.has(d.key),v=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let T=!1;d&&m?d.data.isEqual(m.data)?I!==v&&(r.track({type:3,doc:m}),T=!0):this.Ia(d,m)||(r.track({type:2,doc:m}),T=!0,(u&&this.ua(m,u)>0||c&&this.ua(m,c)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),T=!0):d&&!m&&(r.track({type:1,doc:d}),T=!0,(u||c)&&(a=!0)),T&&(m?(o=o.add(m),s=v?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){const s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const o=t.Pa.k_();o.sort((l,h)=>function(m,I){const v=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return v(m)-v(I)}(l.type,h.type)||this.ua(l.doc,h.doc)),this.Ta(r),i=null!=i&&i;const a=e&&!i?this.Ea():[],u=0===this.aa.size&&this.current&&!i?1:0,c=u!==this._a;return this._a=u,0!==o.length||c?{snapshot:new Sn(this.query,t.ca,s,o,t.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new nd,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach(e=>this.oa=this.oa.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.oa=this.oa.delete(e)),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=N(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});const e=[];return t.forEach(r=>{this.aa.has(r)||e.push(new od(r))}),this.aa.forEach(r=>{t.has(r)||e.push(new sd(r))}),e}Ra(t){this.oa=t.hs,this.aa=N();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return Sn.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class xp{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class Cp{constructor(t){this.key=t,this.ma=!1}}class bp{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new Ht(a=>Il(a),fr),this.pa=new Map,this.ya=new Set,this.wa=new j(A.comparator),this.Sa=new Map,this.ba=new Do,this.Da={},this.Ca=new Map,this.va=Oe.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}function Dp(n,t){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,p.Z)(function*(n,t){const e=Ga(n);let r,i;const s=e.ga.get(t);if(s)r=s.targetId,e.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const o=yield En(e.localStore,wt(t)),a=e.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield Ta(e,t,r,"current"===a,o.resumeToken),e.isPrimaryClient&&$i(e.remoteStore,o)}return i}),Ia.apply(this,arguments)}function Ta(n,t,e,r,i){return Ea.apply(this,arguments)}function Ea(){return Ea=(0,p.Z)(function*(n,t,e,r,i){n.Ma=(h,d,m)=>{return(I=(0,p.Z)(function*(T,S,D,x){let k=S.view.ha(D);k.Xi&&(k=yield Gi(T.localStore,S.query,!1).then(({documents:Nt})=>S.view.ha(Nt,k)));const K=x&&x.targetChanges.get(S.targetId),G=x&&null!=x.targetMismatches.get(S.targetId),at=S.view.applyChanges(k,T.isPrimaryClient,K,G);return ba(T,S.targetId,at.da),at.snapshot}),function v(T,S,D,x){return I.apply(this,arguments)})(n,h,d,m);var I};const s=yield Gi(n.localStore,t,!0),o=new ad(t,s.hs),a=o.ha(s.documents),u=Er.createSynthesizedTargetChangeForCurrentChange(e,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);ba(n,e,c.da);const l=new xp(t,e,o);return n.ga.set(t,l),n.pa.has(e)?n.pa.get(e).push(t):n.pa.set(e,[t]),c.snapshot}),Ea.apply(this,arguments)}function Np(n,t){return va.apply(this,arguments)}function va(){return va=(0,p.Z)(function*(n,t){const e=E(n),r=e.ga.get(t),i=e.pa.get(r.targetId);if(i.length>1)return e.pa.set(r.targetId,i.filter(s=>!fr(s,t))),void e.ga.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||(yield vn(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),Nr(e.remoteStore,r.targetId),xn(e,r.targetId)}).catch(ne))):(xn(e,r.targetId),yield vn(e.localStore,r.targetId,!0))}),va.apply(this,arguments)}function Aa(){return Aa=(0,p.Z)(function*(n,t,e){const r=za(n);try{const i=yield function(o,a){const u=E(o),c=Z.now(),l=a.reduce((m,I)=>m.add(I.key),N());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",m=>{let I=Vt(),v=N();return u.os.getEntries(m,l).next(T=>{I=T,I.forEach((S,D)=>{D.isValidDocument()||(v=v.add(S))})}).next(()=>u.localDocuments.getOverlayedDocuments(m,I)).next(T=>{h=T;const S=[];for(const D of a){const x=cg(D,h.get(D.key).overlayedDocument);null!=x&&S.push(new Zt(D.key,x,il(x.value.mapValue),Y.exists(!0)))}return u.mutationQueue.addMutationBatch(m,c,S,a)}).next(T=>{d=T;const S=T.applyToLocalDocumentSet(h,v);return u.documentOverlayCache.saveOverlays(m,T.batchId,S)})}).then(()=>({batchId:d.batchId,changes:Al(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Da[o.currentUser.toKey()];c||(c=new j(C)),c=c.insert(a,u),o.Da[o.currentUser.toKey()]=c}(r,i.batchId,e),yield Xt(r,i.changes),yield wn(r.remoteStore)}catch(i){const s=Pn(i,"Failed to persist write");e.reject(s)}}),Aa.apply(this,arguments)}function ud(n,t){return wa.apply(this,arguments)}function wa(){return wa=(0,p.Z)(function*(n,t){const e=E(n);try{const r=yield function tp(n,t){const e=E(n),r=t.snapshotVersion;let i=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=e.os.newChangeBuffer({trackRemovals:!0});i=e.ns;const a=[];t.targetChanges.forEach((l,h)=>{const d=i.get(h);if(!d)return;a.push(e.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.Qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);var v,T,S;null!==t.targetMismatches.get(h)?m=m.withResumeToken(ot.EMPTY_BYTE_STRING,V.min()).withLastLimboFreeSnapshotVersion(V.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),T=m,S=l,(0===(v=d).resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0)&&a.push(e.Qr.updateTargetData(s,m))});let u=Vt(),c=N();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Bh(s,o,t.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(V.min())){const l=e.Qr.getLastRemoteSnapshotVersion(s).next(h=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(e.ns=i,s))}(e.localStore,t);t.targetChanges.forEach((i,s)=>{const o=e.Sa.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?P(o.ma):i.removedDocuments.size>0&&(P(o.ma),o.ma=!1))}),yield Xt(e,r,t)}catch(r){yield ne(r)}}),wa.apply(this,arguments)}function cd(n,t,e){const r=E(n);if(r.isPrimaryClient&&0===e||!r.isPrimaryClient&&1===e){const i=[];r.ga.forEach((s,o)=>{const a=o.view.U_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=E(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const d of h.Q_)d.U_(a)&&(c=!0)}),c&&_a(u)}(r.eventManager,t),i.length&&r.fa.u_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Mp(n,t,e){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,p.Z)(function*(n,t,e){const r=E(n);r.sharedClientState.updateQueryState(t,"rejected",e);const i=r.Sa.get(t),s=i&&i.key;if(s){let o=new j(A.comparator);o=o.insert(s,H.newNoDocument(s,V.min()));const a=N().add(s),u=new Tr(V.min(),new Map,new j(C),o,a);yield ud(r,u),r.wa=r.wa.remove(s),r.Sa.delete(t),Da(r)}else yield vn(r.localStore,t,!1).then(()=>xn(r,t,e)).catch(ne)}),Ra.apply(this,arguments)}function Fp(n,t){return Pa.apply(this,arguments)}function Pa(){return Pa=(0,p.Z)(function*(n,t){const e=E(n),r=t.batch.batchId;try{const i=yield function Jg(n,t){const e=E(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,d=h.keys();let m=f.resolve();return d.forEach(I=>{m=m.next(()=>l.getEntry(u,I)).next(v=>{const T=c.docVersions.get(I);P(null!==T),v.version.compareTo(T)<0&&(h.applyToRemoteDocument(v,c),v.isValidDocument()&&(v.setReadTime(c.commitVersion),l.addEntry(v)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=N();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}(e.localStore,t);Ca(e,r,null),xa(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Xt(e,i)}catch(i){yield ne(i)}}),Pa.apply(this,arguments)}function Op(n,t,e){return Va.apply(this,arguments)}function Va(){return Va=(0,p.Z)(function*(n,t,e){const r=E(n);try{const i=yield function(o,a){const u=E(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);Ca(r,t,e),xa(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Xt(r,i)}catch(i){yield ne(i)}}),Va.apply(this,arguments)}function Sa(){return Sa=(0,p.Z)(function*(n,t){const e=E(n);ge(e.remoteStore)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=E(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(-1===r)return void t.resolve();const i=e.Ca.get(r)||[];i.push(t),e.Ca.set(r,i)}catch(r){const i=Pn(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}}),Sa.apply(this,arguments)}function xa(n,t){(n.Ca.get(t)||[]).forEach(e=>{e.resolve()}),n.Ca.delete(t)}function Ca(n,t,e){const r=E(n);let i=r.Da[r.currentUser.toKey()];if(i){const s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function xn(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.pa.get(t))n.ga.delete(r),e&&n.fa.xa(r,e);n.pa.delete(t),n.isPrimaryClient&&n.ba.Vr(t).forEach(r=>{n.ba.containsKey(r)||ld(n,r)})}function ld(n,t){n.ya.delete(t.path.canonicalString());const e=n.wa.get(t);null!==e&&(Nr(n.remoteStore,e),n.wa=n.wa.remove(t),n.Sa.delete(e),Da(n))}function ba(n,t,e){for(const r of e)r instanceof sd?(n.ba.addReference(r.key,t),qp(n,r)):r instanceof od?(y("SyncEngine","Document no longer in limbo: "+r.key),n.ba.removeReference(r.key,t),n.ba.containsKey(r.key)||ld(n,r.key)):R()}function qp(n,t){const e=t.key,r=e.path.canonicalString();n.wa.get(e)||n.ya.has(r)||(y("SyncEngine","New document in limbo: "+e),n.ya.add(r),Da(n))}function Da(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){const t=n.ya.values().next().value;n.ya.delete(t);const e=new A(F.fromString(t)),r=n.va.next();n.Sa.set(r,new Cp(e)),n.wa=n.wa.insert(e,r),$i(n.remoteStore,new Yt(wt(un(e.path)),r,"TargetPurposeLimboResolution",Ct._e))}}function Xt(n,t,e){return Na.apply(this,arguments)}function Na(){return Na=(0,p.Z)(function*(n,t,e){const r=E(n),i=[],s=[],o=[];var a;r.ga.isEmpty()||(r.ga.forEach((a,u)=>{o.push(r.Ma(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=Oo.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield(a=(0,p.Z)(function*(c,l){const h=E(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>f.forEach(l,m=>f.forEach(m.qi,I=>h.persistence.referenceDelegate.addReference(d,m.targetId,I)).next(()=>f.forEach(m.Qi,I=>h.persistence.referenceDelegate.removeReference(d,m.targetId,I)))))}catch(d){if(!re(d))throw d;y("LocalStore","Failed to update sequence numbers: "+d)}for(const d of l){const m=d.targetId;if(!d.fromCache){const I=h.ns.get(m),T=I.withLastLimboFreeSnapshotVersion(I.snapshotVersion);h.ns=h.ns.insert(m,T)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Na.apply(this,arguments)}function Bp(n,t){return ka.apply(this,arguments)}function ka(){return ka=(0,p.Z)(function*(n,t){const e=E(n);if(!e.currentUser.isEqual(t)){y("SyncEngine","User change. New user:",t.toKey());const r=yield Lh(e.localStore,t);e.currentUser=t,(s=e).Ca.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ca.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Xt(e,r.us)}var s}),ka.apply(this,arguments)}function Up(n,t){const e=E(n),r=e.Sa.get(t);if(r&&r.ma)return N().add(r.key);{let i=N();const s=e.pa.get(t);if(!s)return i;for(const o of s){const a=e.ga.get(o);i=i.unionWith(a.view.la)}return i}}function Gp(n,t){return Ma.apply(this,arguments)}function Ma(){return Ma=(0,p.Z)(function*(n,t){const e=E(n),r=yield Gi(e.localStore,t.query,!0),i=t.view.Ra(r);return e.isPrimaryClient&&ba(e,t.targetId,i.da),i}),Ma.apply(this,arguments)}function zp(n,t){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,p.Z)(function*(n,t){const e=E(n);return Gh(e.localStore,t).then(r=>Xt(e,r))}),Fa.apply(this,arguments)}function Kp(n,t,e,r){return Oa.apply(this,arguments)}function Oa(){return Oa=(0,p.Z)(function*(n,t,e,r){const i=E(n),s=yield function(a,u){const c=E(a),l=E(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):f.resolve(null)))}(i.localStore,t);var u;null!==s?("pending"===e?yield wn(i.remoteStore):"acknowledged"===e||"rejected"===e?(Ca(i,t,r||null),xa(i,t),u=t,E(E(i.localStore).mutationQueue).Mn(u)):R(),yield Xt(i,s)):y("SyncEngine","Cannot apply mutation batch with id: "+t)}),Oa.apply(this,arguments)}function La(){return La=(0,p.Z)(function*(n,t){const e=E(n);if(Ga(e),za(e),!0===t&&!0!==e.Fa){const r=e.sharedClientState.getAllActiveQueryTargets(),i=yield hd(e,r.toArray());e.Fa=!0,yield la(e.remoteStore,!0);for(const s of i)$i(e.remoteStore,s)}else if(!1===t&&!1!==e.Fa){const r=[];let i=Promise.resolve();e.pa.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(xn(e,o),vn(e.localStore,o,!0))),Nr(e.remoteStore,o)}),yield i,yield hd(e,r),function(o){const a=E(o);a.Sa.forEach((u,c)=>{Nr(a.remoteStore,c)}),a.ba.mr(),a.Sa=new Map,a.wa=new j(A.comparator)}(e),e.Fa=!1,yield la(e.remoteStore,!1)}}),La.apply(this,arguments)}function hd(n,t,e){return qa.apply(this,arguments)}function qa(){return qa=(0,p.Z)(function*(n,t,e){const r=E(n),i=[],s=[];for(const o of t){let a;const u=r.pa.get(o);if(u&&0!==u.length){a=yield En(r.localStore,wt(u[0]));for(const c of u){const l=r.ga.get(c),h=yield Gp(r,l);h.snapshot&&s.push(h.snapshot)}}else{const c=yield Uh(r.localStore,o);a=yield En(r.localStore,c),yield Ta(r,dd(c),o,!1,a.resumeToken)}i.push(a)}return r.fa.u_(s),i}),qa.apply(this,arguments)}function dd(n){return pl(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Qp(n){return e=E(n).localStore,E(E(e).persistence).Li();var e}function $p(n,t,e,r){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,p.Z)(function*(n,t,e,r){const i=E(n);if(i.Fa)return void y("SyncEngine","Ignoring unexpected query state notification.");const s=i.pa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{const o=yield Gh(i.localStore,Tl(s[0])),a=Tr.createSynthesizedRemoteEventForCurrentChange(t,"current"===e,ot.EMPTY_BYTE_STRING);yield Xt(i,o,a);break}case"rejected":yield vn(i.localStore,t,!0),xn(i,t,r);break;default:R()}}),Ba.apply(this,arguments)}function Wp(n,t,e){return Ua.apply(this,arguments)}function Ua(){return Ua=(0,p.Z)(function*(n,t,e){const r=Ga(n);if(r.Fa){for(const i of t){if(r.pa.has(i)){y("SyncEngine","Adding an already active target "+i);continue}const s=yield Uh(r.localStore,i),o=yield En(r.localStore,s);yield Ta(r,dd(s),o.targetId,!1,o.resumeToken),$i(r.remoteStore,o)}for(const i of e)r.pa.has(i)&&(yield vn(r.localStore,i,!1).then(()=>{Nr(r.remoteStore,i),xn(r,i)}).catch(ne))}}),Ua.apply(this,arguments)}function Ga(n){const t=E(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=ud.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Up.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Mp.bind(null,t),t.fa.u_=Rp.bind(null,t.eventManager),t.fa.xa=Pp.bind(null,t.eventManager),t}function za(n){const t=E(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Fp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Op.bind(null,t),t}class kr{constructor(){this.synchronizeTabs=!1}initialize(t){var e=this;return(0,p.Z)(function*(){e.serializer=br(t.databaseInfo.databaseId),e.sharedClientState=e.createSharedClientState(t),e.persistence=e.createPersistence(t),yield e.persistence.start(),e.localStore=e.createLocalStore(t),e.gcScheduler=e.createGarbageCollectionScheduler(t,e.localStore),e.indexBackfillerScheduler=e.createIndexBackfillerScheduler(t,e.localStore)})()}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Oh(this.persistence,new Fh,t.initialUser,this.serializer)}createPersistence(t){return new No(qi.Hr,this.serializer)}createSharedClientState(t){return new Qh}terminate(){var t=this;return(0,p.Z)(function*(){var e,r;null===(e=t.gcScheduler)||void 0===e||e.stop(),null===(r=t.indexBackfillerScheduler)||void 0===r||r.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}class Ka extends kr{constructor(t,e,r){super(),this.Na=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){var e=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield e().call(r,t),yield r.Na.initialize(r,t),yield za(r.Na.syncEngine),yield wn(r.Na.remoteStore),yield r.persistence.fi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(t){return Oh(this.persistence,new Fh,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){return new Vh(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){const r=new Em(e,this.persistence);return new Tm(t.asyncQueue,r)}createPersistence(t){const e=Fo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Et.withCacheSize(this.cacheSizeBytes):Et.DEFAULT;return new Mo(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,Wh(),Qi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new Qh}}class fd extends Ka{constructor(t,e){super(t,e,!1),this.Na=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){var e=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield e().call(r,t);const i=r.Na.syncEngine;r.sharedClientState instanceof jo&&(r.sharedClientState.syncEngine={Zs:Kp.bind(null,i),Xs:$p.bind(null,i),eo:Wp.bind(null,i),Li:Qp.bind(null,i),Ys:zp.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.fi(function(){var s=(0,p.Z)(function*(o){yield function jp(n,t){return La.apply(this,arguments)}(r.Na.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(t){const e=Wh();if(!jo.D(e))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Fo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new jo(e,t.asyncQueue,r,t.clientId,t.initialUser)}}class Cn{initialize(t,e){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=t.localStore,r.sharedClientState=t.sharedClientState,r.datastore=r.createDatastore(e),r.remoteStore=r.createRemoteStore(e),r.eventManager=r.createEventManager(e),r.syncEngine=r.createSyncEngine(e,!t.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>cd(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Bp.bind(null,r.syncEngine),yield la(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(t){return new wp}createDatastore(t){const e=br(t.databaseInfo.databaseId),r=new ap(t.databaseInfo);return new lp(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return r=this.localStore,i=this.datastore,s=t.asyncQueue,o=e=>cd(this.syncEngine,e,0),a=$h.D()?new $h:new ip,new fp(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(t,e){return function(i,s,o,a,u,c,l){const h=new bp(i,s,o,a,u,c);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){var t=this;return(0,p.Z)(function*(){var e,r;yield(r=(0,p.Z)(function*(s){const o=E(s);y("RemoteStore","RemoteStore shutting down."),o.v_.add(5),yield An(o),o.M_.shutdown(),o.x_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(t.remoteStore),null===(e=t.datastore)||void 0===e||e.terminate()})()}}function md(n,t=10240){let e=0;return{read:()=>(0,p.Z)(function*(){if(e<n.byteLength){const r={value:n.slice(e,e+t),done:!1};return e+=t,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Hi{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):nt("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Yp{constructor(t,e){this.ka=t,this.serializer=e,this.metadata=new st,this.buffer=new Uint8Array,this.qa=new TextDecoder("utf-8"),this.Qa().then(r=>{r&&r.ea()?this.metadata.resolve(r.X_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.X_)}`))},r=>this.metadata.reject(r))}close(){return this.ka.cancel()}getMetadata(){var t=this;return(0,p.Z)(function*(){return t.metadata.promise})()}Oa(){var t=this;return(0,p.Z)(function*(){return yield t.getMetadata(),t.Qa()})()}Qa(){var t=this;return(0,p.Z)(function*(){const e=yield t.Ka();if(null===e)return null;const r=t.qa.decode(e),i=Number(r);isNaN(i)&&t.$a(`length string (${r}) is not valid number`);const s=yield t.Ua(i);return new Vp(JSON.parse(s),e.length+i)})()}Wa(){return this.buffer.findIndex(t=>123===t)}Ka(){var t=this;return(0,p.Z)(function*(){for(;t.Wa()<0&&!(yield t.Ga()););if(0===t.buffer.length)return null;const e=t.Wa();e<0&&t.$a("Reached the end of bundle when a length string is expected.");const r=t.buffer.slice(0,e);return t.buffer=t.buffer.slice(e),r})()}Ua(t){var e=this;return(0,p.Z)(function*(){for(;e.buffer.length<t;)(yield e.Ga())&&e.$a("Reached the end of bundle when more is expected.");const r=e.qa.decode(e.buffer.slice(0,t));return e.buffer=e.buffer.slice(t),r})()}$a(t){throw this.ka.cancel(),new Error(`Invalid bundle format: ${t}`)}Ga(){var t=this;return(0,p.Z)(function*(){const e=yield t.ka.read();if(!e.done){const r=new Uint8Array(t.buffer.length+e.value.length);r.set(t.buffer),r.set(e.value,t.buffer.length),t.buffer=r}return e.done})()}}class Xp{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.mutations.length>0)throw e.lastTransactionError=new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),e.lastTransactionError;const r=yield(i=(0,p.Z)(function*(o,a){const u=E(o),c={documents:a.map(m=>vr(u.serializer,m))},l=yield u.vo("BatchGetDocuments",u.serializer.databaseId,F.emptyPath(),c,a.length),h=new Map;l.forEach(m=>{const I=function Ig(n,t){return"found"in t?function(r,i){P(!!i.found);const s=zt(r,i.found.name),o=rt(i.found.updateTime),a=i.found.createTime?rt(i.found.createTime):V.min(),u=new pt({mapValue:{fields:i.found.fields}});return H.newFoundDocument(s,o,a,u)}(n,t):"missing"in t?function(r,i){P(!!i.missing),P(!!i.readTime);const s=zt(r,i.missing),o=rt(i.readTime);return H.newNoDocument(s,o)}(n,t):R()}(u.serializer,m);h.set(I.key.toString(),I)});const d=[];return a.forEach(m=>{const I=h.get(m.toString());P(!!I),d.push(I)}),d}),function s(o,a){return i.apply(this,arguments)})(e.datastore,t);var i;return r.forEach(i=>e.recordVersion(i)),r})()}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new mn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.lastTransactionError)throw t.lastTransactionError;const e=t.readVersions;var r;t.mutations.forEach(r=>{e.delete(r.key.toString())}),e.forEach((r,i)=>{const s=A.fromPath(i);t.mutations.push(new mo(s,t.precondition(s)))}),yield(r=(0,p.Z)(function*(s,o){const a=E(s),u={writes:o.map(c=>Ar(a.serializer,c))};yield a.So("Commit",a.serializer.databaseId,F.emptyPath(),u)}),function i(s,o){return r.apply(this,arguments)})(t.datastore,t.mutations),t.committed=!0})()}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw R();e=V.min()}const r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(V.min())?Y.exists(!1):Y.updateTime(e):Y.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(V.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Y.updateTime(e)}return Y.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class Jp{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.za=r.maxAttempts,this.jo=new $o(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){var t=this;this.jo.qo((0,p.Z)(function*(){const e=new Xp(t.datastore),r=t.Ja(e);r&&r.then(i=>{t.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{t.deferred.resolve(i)}).catch(s=>{t.Ya(s)}))}).catch(i=>{t.Ya(i)})}))}Ja(t){try{const e=this.updateFunction(t);return!sr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ya(t){this.za>0&&this.Za(t)?(this.za-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ha(),Promise.resolve()))):this.deferred.reject(t)}Za(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!Ll(e)}return!1}}class t_{constructor(t,e,r,i){var s=this;this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=lt.UNAUTHENTICATED,this.clientId=kc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){y("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(y("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var t=this;this.asyncQueue.enterRestrictedMode();const e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{t._onlineComponents&&(yield t._onlineComponents.terminate()),t._offlineComponents&&(yield t._offlineComponents.terminate()),t.authCredentials.shutdown(),t.appCheckCredentials.shutdown(),e.resolve()}catch(r){const i=Pn(r,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}function Zi(n,t){return ja.apply(this,arguments)}function ja(){return ja=(0,p.Z)(function*(n,t){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");const e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(s){r.isEqual(s)||(yield Lh(t.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}),ja.apply(this,arguments)}function Qa(n,t){return $a.apply(this,arguments)}function $a(){return $a=(0,p.Z)(function*(n,t){n.asyncQueue.verifyOperationInProgress();const e=yield Wa(n);y("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>ed(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>ed(t.remoteStore,i)),n._onlineComponents=t}),$a.apply(this,arguments)}function gd(n){return"FirebaseError"===n.name?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Wa(n){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,p.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Zi(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!gd(e))throw e;Rt("Error using user provided cache. Falling back to memory cache: "+e),yield Zi(n,new kr)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Zi(n,new kr);return n._offlineComponents}),Ha.apply(this,arguments)}function Yi(n){return Za.apply(this,arguments)}function Za(){return Za=(0,p.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield Qa(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield Qa(n,new Cn))),n._onlineComponents}),Za.apply(this,arguments)}function pd(n){return Wa(n).then(t=>t.persistence)}function bn(n){return Wa(n).then(t=>t.localStore)}function _d(n){return Yi(n).then(t=>t.remoteStore)}function Ya(n){return Yi(n).then(t=>t.syncEngine)}function Dn(n){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,p.Z)(function*(n){const t=yield Yi(n),e=t.eventManager;return e.onListen=Dp.bind(null,t.syncEngine),e.onUnlisten=Np.bind(null,t.syncEngine),e}),Xa.apply(this,arguments)}function Id(n,t,e={}){const r=new st;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Hi({next:d=>{o.enqueueAndForget(()=>ga(s,h));const m=d.docs.has(a);!m&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&u&&"server"===u.source?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new ya(un(a.path),l,{includeMetadataChanges:!0,Z_:!0});return fa(s,h)}(yield Dn(n),n.asyncQueue,t,e,r)})),r.promise}function Td(n,t,e={}){const r=new st;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Hi({next:d=>{o.enqueueAndForget(()=>ga(s,h)),d.fromCache&&"server"===u.source?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new ya(a,l,{includeMetadataChanges:!0,Z_:!0});return fa(s,h)}(yield Dn(n),n.asyncQueue,t,e,r)})),r.promise}function Ed(n){const t={};return void 0!==n.timeoutSeconds&&(t.timeoutSeconds=n.timeoutSeconds),t}const vd=new Map;function Ja(n,t,e){if(!e)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Ad(n,t,e,r){if(!0===t&&!0===r)throw new _(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function wd(n){if(!A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Rd(n){if(A.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Xi(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const t=(r=n).constructor?r.constructor.name:null;return t?`a custom ${t} object`:"an object"}}var r;return"function"==typeof n?"a function":R()}function M(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Xi(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Pd(n,t){if(t<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}class Vd{constructor(t){var e,r;if(void 0===t.host){if(void 0!==t.ssl)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Ad("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==t.experimentalAutoDetectLongPolling&&!t.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Ed(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===t.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Mr{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vd(t),void 0!==t.credentials&&(this._authCredentials=function(r){if(!r)return new um;switch(r.type){case"firstParty":return new dm(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const r=vd.get(e);r&&(y("ComponentProvider","Removing Datastore"),vd.delete(e),r.terminate())}(this),Promise.resolve()}}function Sd(n,t,e,r={}){var i;const s=(n=M(n,Mr))._getSettings(),o=`${t}:${e}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Rt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=lt.MOCK_USER;else{a=(0,q.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new lt(c)}n._authCredentials=new cm(new Dc(a,u))}}class _t{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new _t(this.firestore,t,this._query)}}class tt{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new tt(this.firestore,t,this._key)}}class Kt extends _t{constructor(t,e,r){super(t,e,un(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new tt(this.firestore,null,new A(t))}withConverter(t){return new Kt(this.firestore,t,this._path)}}function h_(n,t,...e){if(n=(0,q.m9)(n),Ja("collection","path",t),n instanceof Mr){const r=F.fromString(t,...e);return Rd(r),new Kt(n,null,r)}{if(!(n instanceof tt||n instanceof Kt))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(t,...e));return Rd(r),new Kt(n.firestore,null,r)}}function d_(n,t){if(n=M(n,Mr),Ja("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new _t(n,null,(r=t,new Wt(F.emptyPath(),r)));var r}function xd(n,t,...e){if(n=(0,q.m9)(n),1===arguments.length&&(t=kc.newId()),Ja("doc","path",t),n instanceof Mr){const r=F.fromString(t,...e);return wd(r),new tt(n,null,new A(r))}{if(!(n instanceof tt||n instanceof Kt))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(t,...e));return wd(r),new tt(n.firestore,n instanceof Kt?n.converter:null,new A(r))}}function f_(n,t){return n=(0,q.m9)(n),t=(0,q.m9)(t),(n instanceof tt||n instanceof Kt)&&(t instanceof tt||t instanceof Kt)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function tu(n,t){return n=(0,q.m9)(n),t=(0,q.m9)(t),n instanceof _t&&t instanceof _t&&n.firestore===t.firestore&&fr(n._query,t._query)&&n.converter===t.converter}class m_{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new $o(this,"async_queue_retry"),this._u=()=>{const e=Qi();e&&y("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const t=Qi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=Qi();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise(()=>{});const e=new st;return this.uu(()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.eu.push(t),this.cu()))}cu(){var t=this;return(0,p.Z)(function*(){if(0!==t.eu.length){try{yield t.eu[0](),t.eu.shift(),t.jo.reset()}catch(e){if(!re(e))throw e;y("AsyncQueue","Operation failed with retryable error: "+e)}t.eu.length>0&&t.jo.qo(()=>t.cu())}})()}uu(t){const e=this.Xa.then(()=>(this.iu=!0,t().catch(r=>{throw this.ru=r,this.iu=!1,nt("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.iu=!1,r))));return this.Xa=e,e}enqueueAfterDelay(t,e,r){this.au(),this.ou.indexOf(t)>-1&&(e=0);const i=da.createAndSchedule(this,t,e,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&R()}verifyOperationInProgress(){}hu(){var t=this;return(0,p.Z)(function*(){let e;do{e=t.Xa,yield e}while(e!==t.Xa)})()}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then(()=>{this.nu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()})}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}function eu(n){return function(e,r){if("object"!=typeof e||null===e)return!1;const i=e;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class g_{constructor(){this._progressObserver={},this._taskCompletionResolver=new st,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const p_=-1;class Q extends Mr{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=new m_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Cd(this),this._firestoreClient.terminate()}}function et(n){return n._firestoreClient||Cd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Cd(n){var t,e,r;const i=n._freezeSettings(),s=(u=(null===(t=n._app)||void 0===t?void 0:t.options.appId)||"",new Gm(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ed(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new t_(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(e=i.localCache)&&void 0!==e&&e._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function __(n,t){Dd(n=M(n,Q));const e=et(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Rt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Cn;return bd(e,i,new Ka(i,r.cacheSizeBytes,t?.forceOwnership))}function y_(n){Dd(n=M(n,Q));const t=et(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Rt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings(),r=new Cn;return bd(t,r,new fd(r,e.cacheSizeBytes))}function bd(n,t,e){const r=new st;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield Zi(n,e),yield Qa(n,t),r.resolve()}catch(i){const s=i;if(!gd(s))throw s;Rt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function I_(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new st;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(e=(0,p.Z)(function*(i){if(!Dt.D())return Promise.resolve();const s=i+"main";yield Dt.delete(s)}),function r(i){return e.apply(this,arguments)})(Fo(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}var e})),t.promise}function T_(n){return function(e){const r=new st;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Lp(n,t){return Sa.apply(this,arguments)}(yield Ya(e),r)})),r.promise}(et(n=M(n,Q)))}function E_(n){return function e_(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const t=yield pd(n),e=yield _d(n);return t.setNetworkEnabled(!0),function(i){const s=E(i);return s.v_.delete(0),Dr(s)}(e)}))}(et(n=M(n,Q)))}function v_(n){return function n_(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const t=yield pd(n),e=yield _d(n);return t.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const o=E(s);o.v_.add(0),yield An(o),o.x_.set("Offline")}),function i(s){return r.apply(this,arguments)})(e);var r}))}(et(n=M(n,Q)))}function A_(n,t){const e=et(n=M(n,Q)),r=new g_;return function o_(n,t,e,r){const i=function(o,a){let u;return u="string"==typeof o?Bl().encode(o):o,l=function(l,h){if(l instanceof Uint8Array)return md(l,h);if(l instanceof ArrayBuffer)return md(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new Yp(l,a);var l}(e,br(t));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function Hp(n,t,e){const r=E(n);var i;(i=(0,p.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(I,v){const T=E(I),S=rt(v.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",D=>T.$r.getBundleMetadata(D,v.id)).then(D=>!!D&&D.createTime.compareTo(S)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(I=c).totalDocuments,bytesLoaded:I.totalBytes,totalDocuments:I.totalDocuments,totalBytes:I.totalBytes}),Promise.resolve(new Set);u._updateProgress(id(c));const l=new Sp(c,o.localStore,a.serializer);let h=yield a.Oa();for(;h;){const m=yield l.na(h);m&&u._updateProgress(m),h=yield a.Oa()}const d=yield l.complete();return yield Xt(o,d.sa,void 0),yield function(I,v){const T=E(I);return T.persistence.runTransaction("Save bundle","readwrite",S=>T.$r.saveBundleMetadata(S,v))}(o.localStore,c),u._completeWith(d.progress),Promise.resolve(d.ia)}catch(c){return Rt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var I}),function s(o,a,u){return i.apply(this,arguments)})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Ya(n),i,r)}))}(e,n._databaseId,t,r),r}function w_(n,t){return function a_(n,t){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(r,i){const s=E(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield bn(n),t)}))}(et(n=M(n,Q)),t).then(e=>e?new _t(n,null,e.query):null)}function Dd(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class _e{constructor(t){this._byteString=t}static fromBase64String(t){try{return new _e(ot.fromBase64String(t))}catch(e){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new _e(ot.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class ye{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new W(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class qe{constructor(t){this._methodName=t}}class Ji{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return C(this._lat,t._lat)||C(this._long,t._long)}}const P_=/^__.*__$/;class V_{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return null!==this.fieldMask?new Zt(t,this.data,this.fieldMask,e,this.fieldTransforms):new fn(t,this.data,e,this.fieldTransforms)}}class Nd{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Zt(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function kd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}class ts{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new ts(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var e;const r=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.Au({path:r,Vu:!1});return i.mu(t),i}fu(t){var e;const r=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return rs(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(0===t.length)throw this.pu("Document fields must not be empty");if(kd(this.du)&&P_.test(t))throw this.pu('Document fields cannot begin and end with "__"')}}class S_{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||br(t)}Su(t,e,r,i=!1){return new ts({du:t,methodName:e,wu:r,path:W.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Be(n){const t=n._freezeSettings(),e=br(n._databaseId);return new S_(n._databaseId,!!t.ignoreUndefinedProperties,e)}function es(n,t,e,r,i,s={}){const o=n.Su(s.merge||s.mergeFields?2:0,t,e,i);uu("Data must be an object, but it was:",o,r);const a=Od(r,o);let u,c;if(s.merge)u=new Pt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const d=Lr(t,h,e);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);qd(l,d)||l.push(d)}u=new Pt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new V_(new pt(a),u,c)}class Or extends qe{_toFieldTransform(t){if(2!==t.du)throw t.pu(1===t.du?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Or}}function Md(n,t,e){return new ts({du:3,wu:t.settings.wu,methodName:n._methodName,Vu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class nu extends qe{_toFieldTransform(t){return new _r(t.path,new hn)}isEqual(t){return t instanceof nu}}class ru extends qe{constructor(t,e){super(t),this.bu=e}_toFieldTransform(t){const e=Md(this,t,!0),r=this.bu.map(s=>Ue(s,e)),i=new Ce(r);return new _r(t.path,i)}isEqual(t){return t instanceof ru&&(0,q.vZ)(this.bu,t.bu)}}class iu extends qe{constructor(t,e){super(t),this.bu=e}_toFieldTransform(t){const e=Md(this,t,!0),r=this.bu.map(s=>Ue(s,e)),i=new be(r);return new _r(t.path,i)}isEqual(t){return t instanceof iu&&(0,q.vZ)(this.bu,t.bu)}}class su extends qe{constructor(t,e){super(t),this.Du=e}_toFieldTransform(t){const e=new dn(t.serializer,Vl(t.serializer,this.Du));return new _r(t.path,e)}isEqual(t){return t instanceof su&&this.Du===t.Du}}function ou(n,t,e,r){const i=n.Su(1,t,e);uu("Data must be an object, but it was:",i,r);const s=[],o=pt.empty();ie(r,(u,c)=>{const l=ns(t,u,e);c=(0,q.m9)(c);const h=i.fu(l);if(c instanceof Or)s.push(l);else{const d=Ue(c,h);null!=d&&(s.push(l),o.set(l,d))}});const a=new Pt(s);return new Nd(o,a,i.fieldTransforms)}function au(n,t,e,r,i,s){const o=n.Su(1,t,e),a=[Lr(t,r,e)],u=[i];if(s.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Lr(t,s[d])),u.push(s[d+1]);const c=[],l=pt.empty();for(let d=a.length-1;d>=0;--d)if(!qd(c,a[d])){const m=a[d];let I=u[d];I=(0,q.m9)(I);const v=o.fu(m);if(I instanceof Or)c.push(m);else{const T=Ue(I,v);null!=T&&(c.push(m),l.set(m,T))}}const h=new Pt(c);return new Nd(l,h,o.fieldTransforms)}function Fd(n,t,e,r=!1){return Ue(e,n.Su(r?4:3,t))}function Ue(n,t){if(Ld(n=(0,q.m9)(n)))return uu("Unsupported field value:",t,n),Od(n,t);if(n instanceof qe)return function(r,i){if(!kd(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(void 0===n&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=Ue(a,i.gu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if(null===(r=(0,q.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Vl(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=Z.fromDate(r);return{timestampValue:gn(i.serializer,s)}}if(r instanceof Z){const s=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:gn(i.serializer,s)}}if(r instanceof Ji)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _e)return{bytesValue:Wl(i.serializer,r._byteString)};if(r instanceof tt){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:To(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${Xi(r)}`)}(n,t)}function Od(n,t){const e={};return Hc(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ie(n,(r,i)=>{const s=Ue(i,t.Ru(r));null!=s&&(e[r]=s)}),{mapValue:{fields:e}}}function Ld(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Ji||n instanceof _e||n instanceof tt||n instanceof qe)}function uu(n,t,e){if(!Ld(e)||"object"!=typeof(i=e)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Xi(e);throw t.pu("an object"===r?n+" a custom object":n+" "+r)}var i}function Lr(n,t,e){if((t=(0,q.m9)(t))instanceof ye)return t._internalPath;if("string"==typeof t)return ns(n,t);throw rs("Field path arguments must be of type string or ",n,!1,void 0,e)}const x_=new RegExp("[~\\*/\\[\\]]");function ns(n,t,e){if(t.search(x_)>=0)throw rs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new ye(...t.split("."))._internalPath}catch{throw rs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function rs(n,t,e,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function qd(n,t){return n.some(e=>e.isEqual(t))}class qr{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new C_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(is("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class C_ extends qr{data(){return super.data()}}function is(n,t){return"string"==typeof t?ns(n,t):t instanceof ye?t._internalPath:t._delegate._internalPath}function Bd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cu{}class Br extends cu{}function b_(n,t,...e){let r=[];t instanceof cu&&r.push(t),r=r.concat(e),function(s){const o=s.filter(u=>u instanceof Nn).length,a=s.filter(u=>u instanceof Ur).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Ur extends Br{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new Ur(t,e,r)}_apply(t){const e=this._parse(t);return Kd(t._query,e),new _t(t.firestore,t.converter,ho(t._query,e))}_parse(t){const e=Be(t.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){zd(h,l);const m=[];for(const I of h)m.push(Gd(u,s,I));d={arrayValue:{values:m}}}else d=Gd(u,s,h)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||zd(h,l),d=Fd(a,"where",h,"in"===l||"not-in"===l);return O.create(c,l,d)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value)}}function D_(n,t,e){const r=t,i=is("where",n);return Ur._create(i,r,e)}class Nn extends cu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Nn(t,e)}_parse(t){const e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return 1===e.length?e[0]:U.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Kd(o,u),o=ho(o,u)}(t._query,e),new _t(t.firestore,t.converter,ho(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class lu extends Br{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new lu(t,e)}_apply(t){const e=function(i,s,o){if(null!==i.startAt)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new hr(s,o)}(t._query,this._field,this._direction);return new _t(t.firestore,t.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new Wt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}}function N_(n,t="asc"){const e=t,r=is("orderBy",n);return lu._create(r,e)}class ss extends Br{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new ss(t,e,r)}_apply(t){return new _t(t.firestore,t.converter,Pi(t._query,this._limit,this._limitType))}}function k_(n){return Pd("limit",n),ss._create("limit",n,"F")}function M_(n){return Pd("limitToLast",n),ss._create("limitToLast",n,"L")}class os extends Br{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new os(t,e,r)}_apply(t){const e=Ud(t,this.type,this._docOrFields,this._inclusive);return new _t(t.firestore,t.converter,(s=e,new Wt((i=t._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}function F_(...n){return os._create("startAt",n,!0)}function O_(...n){return os._create("startAfter",n,!1)}class as extends Br{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new as(t,e,r)}_apply(t){const e=Ud(t,this.type,this._docOrFields,this._inclusive);return new _t(t.firestore,t.converter,(s=e,new Wt((i=t._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function L_(...n){return as._create("endBefore",n,!1)}function q_(...n){return as._create("endAt",n,!0)}function Ud(n,t,e,r){if(e[0]=(0,q.m9)(e[0]),e[0]instanceof qr)return function(s,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of cn(s))if(h.field.isKeyField())l.push(Se(o,u.key));else{const d=u.data.field(h.field);if(Ii(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const m=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}l.push(d)}return new le(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{const i=Be(n.firestore);return function(o,a,u,c,l,h){const d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let I=0;I<l.length;I++){const v=l[I];if(d[I].field.isKeyField()){if("string"!=typeof v)throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof v}`);if(!lo(o)&&-1!==v.indexOf("/"))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${v}' contains a slash.`);const T=o.path.child(F.fromString(v));if(!A.isDocumentKey(T))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);const S=new A(T);m.push(Se(a,S))}else{const T=Fd(u,c,v);m.push(T)}}return new le(m,h)}(n._query,n.firestore._databaseId,i,t,e,r)}}function Gd(n,t,e){if("string"==typeof(e=(0,q.m9)(e))){if(""===e)throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!lo(t)&&-1!==e.indexOf("/"))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const r=t.path.child(F.fromString(e));if(!A.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Se(n,new A(r))}if(e instanceof tt)return Se(n,e._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(e)}.`)}function zd(n,t){if(!Array.isArray(n)||0===n.length)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Kd(n,t){const e=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==e)throw new _(g.INVALID_ARGUMENT,e===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class hu{convertValue(t,e="none"){switch(ue(t)){case 0:return null;case 1:return t.booleanValue;case 2:return J(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes($t(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw R()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return ie(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertGeoPoint(t){return new Ji(J(t.latitude),J(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":const r=Ti(t);return null==r?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(ar(t));default:return null}}convertTimestamp(t){const e=se(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=F.fromString(t);P(sh(r));const i=new oe(r.get(1),r.get(3)),s=new A(r.popFirst(5));return i.isEqual(e)||nt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function us(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class B_ extends hu{constructor(t){super(),this.firestore=t}convertBytes(t){return new _e(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}}class Ge{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ze extends qr{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(is("DocumentSnapshot.get",t));if(null!==r)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}}class Gr extends ze{data(t={}){return super.data(t)}}class Ke{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Ge(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Gr(this._firestore,this._userDataWriter,r.key,r,new Ge(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new Gr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ge(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new Gr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ge(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:G_(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function G_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function z_(n,t){return n instanceof ze&&t instanceof ze?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(null===n._document?null===t._document:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Ke&&t instanceof Ke&&n._firestore===t._firestore&&tu(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function K_(n){n=M(n,tt);const t=M(n.firestore,Q);return Id(et(t),n._key).then(e=>du(t,n,e))}class Ie extends hu{constructor(t){super(),this.firestore=t}convertBytes(t){return new _e(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}}function j_(n){n=M(n,tt);const t=M(n.firestore,Q),e=et(t),r=new Ie(t);return function r_(n,t){const e=new st;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield function(l,h){const d=E(l);return d.persistence.runTransaction("read document","readonly",m=>d.localDocuments.getDocument(m,h))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Pn(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield bn(n),t,e);var r})),e.promise}(e,n._key).then(i=>new ze(t,r,n._key,i,new Ge(null!==i&&i.hasLocalMutations,!0),n.converter))}function Q_(n){n=M(n,tt);const t=M(n.firestore,Q);return Id(et(t),n._key,{source:"server"}).then(e=>du(t,n,e))}function $_(n){n=M(n,_t);const t=M(n.firestore,Q),e=et(t),r=new Ie(t);return Bd(n._query),Td(e,n._query).then(i=>new Ke(t,r,n,i))}function W_(n){n=M(n,_t);const t=M(n.firestore,Q),e=et(t),r=new Ie(t);return function i_(n,t){const e=new st;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield Gi(s,o,!0),c=new ad(o,u.hs),l=c.ha(u.documents),h=c.applyChanges(l,!1);a.resolve(h.snapshot)}catch(u){const c=Pn(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield bn(n),t,e);var r})),e.promise}(e,n._query).then(i=>new Ke(t,r,n,i))}function H_(n){n=M(n,_t);const t=M(n.firestore,Q),e=et(t),r=new Ie(t);return Td(e,n._query,{source:"server"}).then(i=>new Ke(t,r,n,i))}function Z_(n,t,e){n=M(n,tt);const r=M(n.firestore,Q),i=us(n.converter,t,e);return kn(r,[es(Be(r),"setDoc",n._key,i,null!==n.converter,e).toMutation(n._key,Y.none())])}function Y_(n,t,e,...r){n=M(n,tt);const i=M(n.firestore,Q),s=Be(i);let o;return o="string"==typeof(t=(0,q.m9)(t))||t instanceof ye?au(s,"updateDoc",n._key,t,e,r):ou(s,"updateDoc",n._key,t),kn(i,[o.toMutation(n._key,Y.exists(!0))])}function X_(n){return kn(M(n.firestore,Q),[new mn(n._key,Y.none())])}function J_(n,t){const e=M(n.firestore,Q),r=xd(n),i=us(n.converter,t);return kn(e,[es(Be(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Y.exists(!1))]).then(()=>r)}function ty(n,...t){var e,r,i;n=(0,q.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||eu(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(eu(t[o])){const h=t[o];t[o]=null===(e=h.next)||void 0===e?void 0:e.bind(h),t[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),t[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof tt)c=M(n.firestore,Q),l=un(n._key.path),u={next:h=>{t[o]&&t[o](du(c,n,h))},error:t[o+1],complete:t[o+2]};else{const h=M(n,_t);c=M(h.firestore,Q),l=h._query;const d=new Ie(c);u={next:m=>{t[o]&&t[o](new Ke(c,d,h,m))},error:t[o+1],complete:t[o+2]},Bd(n._query)}return function(d,m,I,v){const T=new Hi(v),S=new ya(m,T,I);return d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return fa(yield Dn(d),S)})),()=>{T.La(),d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return ga(yield Dn(d),S)}))}}(et(c),l,a,u)}function ey(n,t){return function s_(n,t){const e=new Hi(t);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield Dn(n),s=e,E(i).K_.add(s),void s.next();var i,s})),()=>{e.La(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield Dn(n),s=e,void E(i).K_.delete(s);var i,s}))}}(et(n=M(n,Q)),eu(t)?t:{next:t})}function kn(n,t){return function(r,i){const s=new st;return r.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function kp(n,t,e){return Aa.apply(this,arguments)}(yield Ya(r),i,s)})),s.promise}(et(n),t)}function du(n,t,e){const r=e.docs.get(t._key),i=new Ie(n);return new ze(n,i,t._key,r,new Ge(e.hasPendingWrites,e.fromCache),t.converter)}const ly={maxAttempts:5};class Qd{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Be(t)}set(t,e,r){this._verifyNotCommitted();const i=Te(t,this._firestore),s=us(i.converter,e,r),o=es(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,Y.none())),this}update(t,e,r,...i){this._verifyNotCommitted();const s=Te(t,this._firestore);let o;return o="string"==typeof(e=(0,q.m9)(e))||e instanceof ye?au(this._dataReader,"WriteBatch.update",s._key,e,r,i):ou(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Y.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Te(t,this._firestore);return this._mutations=this._mutations.concat(new mn(e._key,Y.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Te(n,t){if((n=(0,q.m9)(n)).firestore!==t)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class hy extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=Be(e)}get(e){const r=Te(e,this._firestore),i=new B_(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return R();const o=s[0];if(o.isFoundDocument())return new qr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new qr(this._firestore,i,r._key,null,r.converter);throw R()})}set(e,r,i){const s=Te(e,this._firestore),o=us(s.converter,r,i),a=es(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(e,r,i,...s){const o=Te(e,this._firestore);let a;return a="string"==typeof(r=(0,q.m9)(r))||r instanceof ye?au(this._dataReader,"Transaction.update",o._key,r,i,s):ou(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){const r=Te(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Te(t,this._firestore),r=new Ie(this._firestore);return super.get(t).then(i=>new ze(this._firestore,r,e._key,i._document,new Ge(!1,!1),e.converter))}}function dy(n,t,e){n=M(n,Q);const r=Object.assign(Object.assign({},ly),e);return function(s){if(s.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new st;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const c=yield function yd(n){return Yi(n).then(t=>t.datastore)}(s);new Jp(s.asyncQueue,c,a,o,u).ja()})),u.promise}(et(n),i=>t(new hy(n,i)),r)}function fy(){return new Or("deleteField")}function my(){return new nu("serverTimestamp")}function gy(...n){return new ru("arrayUnion",n)}function py(...n){return new iu("arrayRemove",n)}function _y(n){return new su("increment",n)}!function(t,e=!0){Je=zr.SDK_VERSION,(0,zr._registerComponent)(new Xd.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Q(new lm(r.getProvider("auth-internal")),new fm(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oe(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,zr.registerVersion)(bc,"4.4.2",t),(0,zr.registerVersion)(bc,"4.4.2","esm2017")}()}}]);